################################################################################
##                  Input Boolean
###################################################
input_boolean:
  gestione_luci_generale_sincronizzazioni:
    name: 'Sincronizzazione'
    icon: mdi:sync

  gestione_luci_tutte:
    name: 'Tutte le luci'
    icon: mdi:lightbulb-group

  gestione_luci_lampadario_soggiorno:
    name: 'Lampadario soggiorno'
    icon: mdi:ceiling-light

  gestione_luci_lampada_soggiorno:
    name: 'Lampada soggiorno'
    icon: mdi:floor-lamp

  gestione_luci_cucina:
    name: 'Luce Cucina'
    icon: mdi:globe-light

  gestione_luci_abat_jour:
    name: 'abat_jour'
    icon: mdi:lamp

  gestione_luci_ingresso_1:
    name: 'Luce Ingresso 1'
    icon: mdi:dome-light

  gestione_luci_ingresso_2:
    name: 'Luce Ingresso 2'
    icon: mdi:dome-light

  gestione_luci_bagno:
    name: 'Luce Bagno'
    icon: mdi:lightbulb

  gestione_luci_studio:
    name: 'Luce Studio'
    icon: mdi:lightbulb

  gestione_luci_cameretta:
    name: 'Luce Cameretta'
    icon: mdi:lightbulb

  gestione_luci_camera_da_letto:
    name: 'Camera da letto'
    icon: mdi:globe-light

  gestione_luci_sync_manuale:
    name: 'Sync Manuale'

  lampada_go_spegnimento_automatico_notte:
    name: 'Spegnimento automatico notte Lampada Go'
    icon: mdi:lightbulb-off

  lampada_go_scena_automatica_notte:
    name: 'Scena automatica notte Lampada Go'
    icon: mdi:theme-light-dark

  gestione_luci_periodo_giorno:
    name: 'Giorno'
  gestione_luci_periodo_crepuscolo:
    name: 'Crepuscolo'
  gestione_luci_periodo_sera:
    name: 'Sera'
  gestione_luci_periodo_notte:
    name: 'Notte'

  spegni_luci_con_allarme:
    name: Spegni luci con allarme
    icon: mdi:lightbulb-multiple-off

  gestione_luci_alza_luci:
    name: Conditional Card Alza luci
  gestione_luci_abbassa_luci:
    name: Conditional Card Abbassa luci

################################################################################
## Input Number
################################################
input_number:
  gestione_luci_transazione_lunga:
    name: Gestione Luci Transazione Lunga
    icon: mdi:transition
    min: 1
    max: 200
    step: 1
    unit_of_measurement: "sec"

  gestione_luci_transazione_corta:
    name: Gestione Luci Transazione Corta
    icon: mdi:transition-masked
    min: 1
    max: 10
    step: 1
    unit_of_measurement: "sec"

  gestione_luci_transazione_alza_abbassa_luci:
    name: Gestione Luci Transazione Alza/Abbassa
    icon: mdi:circle-opacity
    min: 1
    max: 50
    step: 1
    unit_of_measurement: "sec"

################################################################################
##                  Input Select
###################################################
input_select:
  gestione_luci_base_sync:
    name: 'Base'
    icon: mdi:theme-light-dark
    options:
      - 'Ora'
      - 'Sole'

  gestione_luci_scena_corrente:
    name: 'Attuale'
    icon: mdi:progress-clock
    options:
      - 'Relax'
      - 'Lettura'
      - 'Energia'
      - 'Concentrazione'
      - 'Luce brillante'
      - 'Luce soffusa'
      - 'Luce notturna'
      - 'Chiaro di luna'

  gestione_luci_scena_diurna_sync:
    name: 'Mattino'
    icon: mdi:progress-clock
    options:
      - 'Relax'
      - 'Lettura'
      - 'Energia'
      - 'Concentrazione'
      - 'Luce brillante'
      - 'Luce soffusa'
      - 'Luce notturna'
      - 'Chiaro di luna'

  gestione_luci_scena_crepuscolare_sync:
    name: 'Crepuscolo'
    icon: mdi:progress-clock
    options:
      - 'Relax'
      - 'Lettura'
      - 'Energia'
      - 'Concentrazione'
      - 'Luce brillante'
      - 'Luce soffusa'
      - 'Luce notturna'
      - 'Chiaro di luna'

  gestione_luci_scena_serale_sync:
    name: 'Sera'
    icon: mdi:progress-clock
    options:
      - 'Relax'
      - 'Lettura'
      - 'Energia'
      - 'Concentrazione'
      - 'Luce brillante'
      - 'Luce soffusa'
      - 'Luce notturna'
      - 'Chiaro di luna'

  gestione_luci_scena_notturna_sync:
    name: 'Notte'
    icon: mdi:progress-clock
    options:
      - 'Relax'
      - 'Lettura'
      - 'Energia'
      - 'Concentrazione'
      - 'Luce brillante'
      - 'Luce soffusa'
      - 'Luce notturna'
      - 'Chiaro di luna'

################################################################################
##                  Input Datetime
###################################################
input_datetime:
  gestione_luci_giorno:
    name: 'Inizio Mattino'
    icon: mdi:weather-sunny
    has_time: true
  gestione_luci_crepuscolo:
    name: 'Inizio Crepuscolo'
    icon: mdi:weather-sunset
    has_time: true
  gestione_luci_sera:
    name: 'Inizio Sera'
    icon: mdi:weather-sunset
    has_time: true
  gestione_luci_notte:
    name: 'Inizio Notte'
    icon: mdi:weather-night
    has_time: true

  lampada_go_attivazione_scena_notte:
    name: 'Lampada Go modalitÃ  notte'
    icon: mdi:weather-night
    has_time: true

  lampada_go_spegnimento_automatico_notte:
    name: 'Lampada Go modalitÃ  notte'
    icon: mdi:weather-night
    has_time: true

################################################################################
##                  Sensor
###################################################
sensor:
  - platform: template
    sensors:
      gestione_luci_fascia_oraria_sync:
        friendly_name: 'Fascia Oraria'
        value_template: >-
          {% if is_state("input_select.gestione_luci_base_sync", "Ora") %}

            {% if is_state('input_boolean.gestione_luci_periodo_giorno', 'on') %}
              Giorno
            {% elif is_state('input_boolean.gestione_luci_periodo_crepuscolo', 'on') %}
              Crepuscolo
            {% elif is_state('input_boolean.gestione_luci_periodo_sera', 'on') %}
              Sera
            {% elif is_state('input_boolean.gestione_luci_periodo_notte', 'on') %}
              Notte
            {% else %}
              Errore
            {% endif %}

          {% elif is_state("input_select.gestione_luci_base_sync", "Sole") %}

            {% if (as_timestamp(states.sun.sun.attributes.next_dusk)) - (as_timestamp(states.sun.sun.attributes.next_setting)) < 0 %}
              Sera
            {% elif (as_timestamp(states.sun.sun.attributes.next_rising)) - (as_timestamp(states.sun.sun.attributes.next_dawn)) < 0 %}
              Notte
            {% elif (states.sun.sun.attributes.elevation) < -5 %}
              Notte
            {% else %}
              Giorno
            {% endif %}

          {% else %}
            Errore
          {% endif %}
        icon_template: mdi:calendar-clock

      gestione_luci_selettore_stanza:
        friendly_name: 'Selettore Stanza'
        value_template: >-
          {% set stanza = states('sensor.last_alexa') %}
          {%- if stanza == "media_player.soggiorno" -%}
            Soggiorno
          {%- elif stanza == "media_player.echo_show_cucina" -%}
            Cucina
          {%- elif stanza == "media_player.studio" -%}
            Studio
          {%- elif stanza == "media_player.camera_da_letto" -%}
            Camera_da_letto
          {%- elif stanza == "media_player.bagno" -%}
            Bagno
          {% else %}
            Errore
          {% endif %}
        icon_template: mdi:floor-plan

      gestione_luci_scena_corrente:
        friendly_name: Scena Corrente
        value_template: >-
          {{ states('input_select.gestione_luci_scena_corrente') }}

      luci_accese:
        friendly_name: 'Luci Accese'
        icon_template: 'mdi:lightbulb-group-outline'
        value_template: "{{ expand('group.tutte_le_luci') | selectattr('state', 'eq', 'on') | list | count }}"

  # - platform: template
  #   sensors:
  #     gestione_luci_fascia_oraria:
  #       friendly_name: 'Fascia Oraria'
  #       icon_template: 'mdi:calendar-clock'
  #       value_template: >-
  #         {% if is_state('input_boolean.gestione_luci_periodo_giorno', 'on') %}
  #           Giorno
  #         {% elif is_state('input_boolean.sensor.gestione_luci_periodo_crepuscolo', 'on') %}
  #           Crepuscolo
  #         {% elif is_state('input_boolean.sensor.gestione_luci_periodo_sera', 'on') %}
  #           Sera
  #         {% elif is_state('input_boolean.sensor.gestione_luci_periodo_notte', 'on') %}
  #           Notte
  #         {% else %}
  #           Errore
  #         {% endif %}

################################################################################
##                  Group
###################################################
group:
  tutte_le_luci:
    entities:
      - light.luce_ingresso
      - light.luce_cucina
      - light.led_1_cucina
      - light.led_2_cucina
      - light.soggiorno_luce_piccola
      - light.soggiorno_luce_grande
      - light.luce_abat_jour
      - light.lampada_sale
      - light.luce_bagno
      - light.luce_studio
      - light.hue_go
      - light.luce_camera_da_letto
      - light.luce_lampada_soggiorno

  luci:
    name: luci per sensore tutti a letto
    entities:
      - light.luce_ingresso
      - light.luce_cucina
      - light.led_1_cucina
      - light.led_2_cucina
      - light.soggiorno_luce_piccola
      - light.soggiorno_luce_grande
      - light.luce_abat_jour
      - light.lampada_sale
      - light.luce_bagno
      - light.luce_studio
      - light.luce_camera_da_letto
      - light.luce_lampada_soggiorno

light:
  - platform: group
    name: Tutte le luci
    entities:
      - light.luce_ingresso
      - light.luce_cucina
      - light.led_1_cucina
      - light.led_2_cucina
      - light.soggiorno_luce_piccola
      - light.soggiorno_luce_grande
      - light.luce_abat_jour
      - light.lampada_sale
      - light.luce_bagno
      - light.luce_studio
      - light.hue_go
      - light.luce_camera_da_letto
      - light.luce_lampada_soggiorno

################################################################################
##                  Script
###################################################
script:
  luci_sync:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - service: script.turn_on
        entity_id:
          - script.gestione_luci_sync_lampadario_soggiorno_transazione_lunga
          - script.gestione_luci_sync_lampada_soggiorno_transazione_lunga
          - script.gestione_luci_sync_bagno_transazione_lunga
          - script.gestione_luci_sync_abat_jour_transazione_lunga
          - script.gestione_luci_ingresso_transazione_lunga
          - script.gestione_luci_studio_transazione_lunga
          - script.gestione_luci_cameretta_transazione_lunga

######################################### Script Luci Transazione Lunga
  gestione_luci_sync_tutte_transazione_lunga:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_tutte
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Tutte'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

  gestione_luci_sync_lampadario_soggiorno_transazione_lunga:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_lampadario_soggiorno
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Lampadario Soggiorno'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

  gestione_luci_sync_lampada_soggiorno_transazione_lunga:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_lampada_soggiorno
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Lampada Soggiorno'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

  gestione_luci_sync_bagno_transazione_lunga:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_bagno
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Bagno'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

  gestione_luci_sync_abat_jour_transazione_lunga:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_abat_jour
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Abat-jour'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

  gestione_luci_ingresso_transazione_lunga:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_ingresso_1
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_ingresso_2
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Ingresso'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

  gestione_luci_studio_transazione_lunga:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_studio
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'studio'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

  gestione_luci_cameretta_transazione_lunga:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_cameretta
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Cameretta'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

######################################### Script Luci Transazione Corta
  gestione_luci_sync_tutte:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_tutte
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Tutte'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"

  gestione_luci_sync_lampadario_soggiorno:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_lampadario_soggiorno
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Lampadario Soggiorno'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"

  gestione_luci_sync_lampada_soggiorno:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_lampada_soggiorno
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Lampada Soggiorno'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"

  gestione_luci_sync_bagno:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_bagno
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Bagno'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"

  gestione_luci_sync_abat_jour:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_abat_jour
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Abat-jour'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"

  gestione_luci_ingresso:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_ingresso_1
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_ingresso_2
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Ingresso'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"

  gestione_luci_studio:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_studio
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'studio'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"

  gestione_luci_cameretta:
    alias: 'Sincronizzazione Modello Attuale'
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: 'on'
      - condition: state
        entity_id: input_boolean.gestione_luci_cameretta
        state: 'on'
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Cameretta'
          scene_name: "{{ states('input_select.gestione_luci_scena_corrente') }}"
          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"

######################################### FINE Script Luci Transazione Corta

  gestione_luci_riattiva_sync:
    alias: 'Riattiva Sincronizzazione automatica'
    icon: mdi:sync-circle
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_tutte
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni

  gestione_luci_stop_sync:
    alias: 'Ferma Sincronizzazione automatica'
    icon: mdi:sync-off
    sequence:
      - service: input_boolean.turn_off
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni

  gestione_luci_alza_luminosita:
    alias: 'Luci al massimo'
    icon: mdi:sync-alert
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - service: hue.hue_activate_scene
        data_template:
          group_name: "{{states('sensor.gestione_luci_selettore_stanza') }}"
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

################################################### Alccendi/Spegni Luci Stanza

  gestione_luci_spegni_luci_stanza:
    alias: 'Spegni luci selezione stanza automatica'
    icon: mdi:sync-alert
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Soggiorno' }}"
          sequence:
            - delay: 5
            - service: light.turn_off
              data:
                entity_id: light.soggiorno_luce_piccola,light.soggiorno_luce_grande,light.luce_abat_jour,light.lampada_sale,light.luce_lampada_soggiorno

        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Cucina' }}"
          sequence:
            - delay: 5
            - service: light.turn_off
              data:
                entity_id: light.luce_cucina,light.led_1_cucina,light.led_2_cucina

        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Camera_da_letto' }}"
          sequence:
            - service: light.turn_off
              data:
                entity_id: light.luce_camera_da_letto

        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Studio' }}"
          sequence:
            - service: light.turn_off
              data:
                entity_id: light.studio

        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Bagno' }}"
          sequence:
            - service: light.turn_off
              data:
                entity_id: light.luce_bagno

  gestione_luci_accendi_luci_stanza:
    alias: 'Accendi luci selezione stanza automatica'
    icon: mdi:sync-alert
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Soggiorno' }}"
          sequence:
            - service: light.turn_on
              data:
                entity_id: light.soggiorno_luce_piccola,light.soggiorno_luce_grande,light.luce_abat_jour,light.lampada_sale,light.luce_lampada_soggiorno

        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Cucina' }}"
          sequence:
            - service: light.turn_on
              data:
                entity_id: light.luce_cucina,light.led_1_cucina,light.led_2_cucina

        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Camera_da_letto' }}"
          sequence:
            - service: light.turn_on
              data:
                entity_id: light.luce_camera_da_letto

        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Studio' }}"
          sequence:
            - service: light.turn_on
              data:
                entity_id: light.studio

        - conditions:
            - condition: template
              value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'Bagno' }}"
          sequence:
            - service: light.turn_on
              data:
                entity_id: light.luce_bagno

################################################### Abbassa Luci
  gestione_luci_abbassa_luci:
    alias: 'Abbassa luci'
    icon: mdi:palette
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: "{{states('sensor.gestione_luci_selettore_stanza')}}"
          scene_name: 'Galassia'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_abbassa_luci_soggiorno:
    alias: 'Abbassa luci Soggiorno'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Soggiorno'
          scene_name: 'Galassia'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_abbassa_luci_cucina:
    alias: 'Abbassa luci Cucina'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Cucina'
          scene_name: 'Galassia'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_abbassa_luci_ingresso:
    alias: 'Abbassa luci Ingresso'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Ingresso'
          scene_name: 'Galassia'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_abbassa_luci_studio:
    alias: 'Abbassa luci Studio'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Studio'
          scene_name: 'Galassia'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_abbassa_luci_camera_da_letto:
    alias: 'Abbassa luci Camera da letto'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Camera da letto'
          scene_name: 'Galassia'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_abbassa_luci_cameretta:
    alias: 'Abbassa luci Cameretta'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Cameretta'
          scene_name: 'Galassia'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_abbassa_luci_bagno:
    alias: 'Abbassa luci Bagno'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Bagno'
          scene_name: 'Galassia'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

################################################### Alza Luci
  gestione_luci_alza_luci:
    alias: 'Alza Luci'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: "{{states('sensor.gestione_luci_selettore_stanza')}}"
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_alza_luci_soggiorno:
    alias: 'Alza luci Soggiorno'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Soggiorno'
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_alza_luci_cucina:
    alias: 'Alza luci Cucina'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Cucina'
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_alza_luci_ingresso:
    alias: 'Alza luci Ingresso'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Ingresso'
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_alza_luci_studio:
    alias: 'Alza luci Studio'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Studio'
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_alza_luci_camera_da_letto:
    alias: 'Alza luci Camera da letto'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Camera da letto'
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_alza_luci_cameretta:
    alias: 'Alza luci Cameretta'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Cameretta'
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  gestione_luci_alza_luci_bagno:
    alias: 'Alza luci Bagno'
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.hue_activate_scene
        data_template:
          group_name: 'Bagno'
          scene_name: 'Lettura'
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

################################################################################
##                  Template
###################################################
template:
  - binary_sensor:
      - name: gestione luci gruppo sync
        state: >
          {{ is_state('input_boolean.gestione_luci_lampadario_soggiorno', 'on')
            and is_state('input_boolean.gestione_luci_lampada_soggiorno', 'on')
            and is_state('input_boolean.gestione_luci_cucina', 'on')
            and is_state('input_boolean.gestione_luci_abat_jour', 'on')
            and is_state('input_boolean.gestione_luci_ingresso_1', 'on')
            and is_state('input_boolean.gestione_luci_ingresso_2', 'on')
            and is_state('input_boolean.gestione_luci_studio', 'on')
            and is_state('input_boolean.gestione_luci_bagno', 'on')
            and is_state('input_boolean.gestione_luci_cameretta', 'on')
            and is_state('input_boolean.gestione_luci_camera_da_letto', 'on') }}

################################################################################
##                  Automation
###################################################
automation:

  - alias: 'gestione_luci_set_fascia_oraria'
    id: 01FH6198R9VKMN775EADTRAZXP
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: time
        at: input_datetime.gestione_luci_giorno
      - platform: time
        at: input_datetime.gestione_luci_crepuscolo
      - platform: time
        at: input_datetime.gestione_luci_sera
      - platform: time
        at: input_datetime.gestione_luci_notte
    action:
      - choose:
          - alias: "se mattino"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_giorno') [0:5] }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_giorno
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_sera
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se crepuscolo"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_crepuscolo') [0:5] }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_crepuscolo
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_sera
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se sera"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_sera') [0:5] }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_sera
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se notte"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_notte') [0:5] }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_notte
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_sera

################################################### SELETTORE GRUPPI
  - alias: 'Gestione_luci_selezione_gruppi_tutte'
    id: 77dc3309b4214f3a7c8c60cce45c1b1e
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
    - platform: state
      entity_id: input_boolean.gestione_luci_tutte
      to: 'on'
    action:
    - service: input_boolean.turn_on
      entity_id:
        - input_boolean.gestione_luci_lampadario_soggiorno
        - input_boolean.gestione_luci_lampada_soggiorno
        - input_boolean.gestione_luci_cucina
        - input_boolean.gestione_luci_bagno
        - input_boolean.gestione_luci_abat_jour
        - input_boolean.gestione_luci_ingresso_1
        - input_boolean.gestione_luci_ingresso_2
        - input_boolean.gestione_luci_studio
        - input_boolean.gestione_luci_cameretta
        - input_boolean.gestione_luci_camera_da_letto
        - input_boolean.lampada_go_spegnimento_automatico_notte
        - input_boolean.lampada_go_scena_automatica_notte

  - alias: 'Gestione_luci_selezione_gruppi_tutte_off'
    id: f0eac9f89913bff1162960e671d81f20
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
    - platform: state
      entity_id: binary_sensor.gestione_luci_gruppo_sync
      to: 'off'
    action:
    - service: input_boolean.turn_off
      entity_id:
        - input_boolean.gestione_luci_tutte

  - alias: 'Gestione_luci_selezione_gruppi_tutte_on'
    id: 3419f0195bc617c35580d481090fb4b0
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
    - platform: state
      entity_id: binary_sensor.gestione_luci_gruppo_sync
      to: 'on'
    action:
    - service: input_boolean.turn_on
      entity_id:
        - input_boolean.gestione_luci_tutte

################################################### FINE SELETTORE GRUPPI

  - alias: 'gestione_luci_sync_impostazioni'
    id: 01FGFMDMV59Q1AXQ5ETBFWP9HG
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
    - platform: homeassistant
      event: start
    - platform: state
      entity_id:
        - sensor.gestione_luci_fascia_oraria_sync
        - input_boolean.gestione_luci_generale_sincronizzazioni

        - input_datetime.gestione_luci_giorno
        - input_datetime.gestione_luci_crepuscolo
        - input_datetime.gestione_luci_sera
        - input_datetime.gestione_luci_notte

        - input_select.gestione_luci_base_sync
        - input_select.gestione_luci_scena_corrente
        - input_select.gestione_luci_scena_diurna_sync
        - input_select.gestione_luci_scena_crepuscolare_sync
        - input_select.gestione_luci_scena_serale_sync
        - input_select.gestione_luci_scena_notturna_sync
        - input_boolean.gestione_luci_generale_sincronizzazioni

        - input_boolean.gestione_luci_lampadario_soggiorno
        - input_boolean.gestione_luci_lampada_soggiorno
        - input_boolean.gestione_luci_cucina
        - input_boolean.gestione_luci_abat_jour
        - input_boolean.gestione_luci_ingresso_1
        - input_boolean.gestione_luci_ingresso_2
        - input_boolean.gestione_luci_bagno
        - input_boolean.gestione_luci_studio
        - input_boolean.gestione_luci_cameretta
        - input_boolean.gestione_luci_camera_da_letto
    condition:
    - condition: state
      entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
      state: 'on'
    action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.gestione_luci_scena_corrente
        option: >-
          {% if is_state("sensor.gestione_luci_fascia_oraria_sync", "Giorno") %}
            {{ states("input_select.gestione_luci_scena_diurna_sync") }}

          {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Crepuscolo") %}
            {{ states("input_select.gestione_luci_scena_crepuscolare_sync") }}

          {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Sera") %}
            {{ states("input_select.gestione_luci_scena_serale_sync") }}

          {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Notte") %}
            {{ states("input_select.gestione_luci_scena_notturna_sync") }}

          {% else %}
            {{ states("input_select.gestione_luci_scena_diurna_sync") }}
          {% endif %}

    - service: script.gestione_luci_sync_lampadario_soggiorno_transazione_lunga
    - service: script.gestione_luci_sync_lampada_soggiorno_transazione_lunga
    - service: script.gestione_luci_sync_bagno_transazione_lunga
    - service: script.gestione_luci_sync_abat_jour_transazione_lunga
    - service: script.gestione_luci_ingresso_transazione_lunga
    - service: script.gestione_luci_studio_transazione_lunga
    - service: script.gestione_luci_cameretta_transazione_lunga

  - alias: 'gestione_luci_sync_transazione_corta'
    id: 01FGA8G1K5T62HYW8DVND37RT3
    mode: single
    max_exceeded: silent
    trigger:
    - platform: state
      entity_id: light.soggiorno_luce_piccola
      to: 'on'
    - platform: state
      entity_id: light.soggiorno_luce_grande
      to: 'on'
    - platform: state
      entity_id: light.luce_abat_jour
      to: 'on'
    - platform: state
      entity_id: light.luce_bagno
      to: 'on'
    - platform: state
      entity_id: light.luce_ingresso
      to: 'on'
    - platform: state
      entity_id: light.luce_lampada_soggiorno
      to: 'on'

    action:
    - service_template: >
        {% if trigger.entity_id == 'light.soggiorno_luce_piccola' %} script.gestione_luci_sync_lampadario_soggiorno
        {% elif trigger.entity_id == 'light.soggiorno_luce_grande' %} script.gestione_luci_sync_lampadario_soggiorno
        {% elif trigger.entity_id == 'light.luce_abat_jour' %} script.gestione_luci_sync_abat_jour
        {% elif trigger.entity_id == 'light.luce_bagno' %} script.gestione_luci_sync_bagno
        {% elif trigger.entity_id == 'light.luce_ingresso' %} script.gestione_luci_ingresso
        {% elif trigger.entity_id == 'light.luce_lampada_soggiorno' %} script.gestione_luci_sync_lampada_soggiorno
        {% endif %}


      # {% set trigger_name = trigger.to_state.entity_id %}
      # ðŸš¨ Triggered by {{ trigger_name.replace('_','\_') }} {{ trigger.to_state.name }} too high for {{ trigger.entity_id }} !

  - alias: 'gestione_luci_reset sync'
    id: 793d8c553d316b6d854449c9f4caf01c
    initial_state: true
    trigger:
      platform: time
      at: '03:00:00'
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.automazioni_luci_tutte
      - service: input_boolean.turn_on
        entity_id: input_boolean.automazioni_luci_generale_sincronizzazioni
      - service: input_boolean.turn_off
        entity_id: input_boolean.gestione_luci_sync_manuale
########################################

  - alias: 'Lampada go scena notte'
    id: 4e7aa161f5bbe043f31cf88262330090
    initial_state: true
    trigger:
      - platform: time
        at: input_datetime.lampada_go_attivazione_scena_notte
    condition:
      - condition: state
        entity_id: input_boolean.lampada_go_scena_automatica_notte
        state: 'on'
    action:
      - service: scene.turn_on
        target:
          entity_id: scene.lampada_go_notte
        data:
          transition: 80

  - alias: 'Lampada go spegnimento automatico'
    id: 4a84e7c4c1f750bad3dd6923cdaf6009
    initial_state: true
    trigger:
      - platform: time
        at: input_datetime.lampada_go_spegnimento_automatico_notte
    condition:
      - condition: state
        entity_id: input_boolean.lampada_go_spegnimento_automatico_notte
        state: 'on'
    action:
      - service: light.turn_off
        target:
          entity_id: light.hue_go


#################################### ACCENDI LUCE RIENTRO SERALE E' NEL PACKAGES PORTA INGRESSO

  # Telecomando on/off e dimming
  - alias: 6 tasti luci con dimmer
    id: eb0225d0b3311517601117d5bf78217d
    mode: restart
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret 6_tasti
    action:
      - variables:
          command: "{{ trigger.event.data.command }}"
          args: "{{ trigger.event.data.args }}"
          light_1: light.luce_ingresso
          light_2: light.soggiorno_luce_piccola
          light_3: light.soggiorno_luce_grande
          light_4: light.luce_abat_jour
          light_5: light.lampadario_soggiorno
          light_6: light.hue_abat_jour
          light_7: light.ingresso
          light_8: light.luce_lampada_soggiorno

      - alias: "Selezione tipo di evento"
        choose:
        - conditions: "{{ command == '1_single' }}"
          sequence:
            - alias: "On/Off luce ingresso"
              service: light.toggle
              target:
                entity_id: "{{ light_1 }}"

        - conditions: "{{ command == '5_single' }}"
          sequence:
            - alias: "On/Off Luce Piccola"
              service: light.toggle
              target:
                entity_id: "{{ light_2 }}"

        - conditions: "{{ command == '5_double' }}"
          sequence:
            - alias: "On/Off Luce Grande"
              service: light.toggle
              target:
                entity_id: "{{ light_3 }}"

        - conditions: "{{ command == '3_single' }}"
          sequence:
            - alias: "On/Off Abat Jour"
              service: light.toggle
              target:
                entity_id: "{{ light_4 }}"

        - conditions: "{{ command == '4_single' }}"
          sequence:
            - alias: "On/Off Lampada Soggiorno"
              service: light.toggle
              target:
                entity_id: "{{ light_8 }}"

        # Dimmer + Lampadario
        - conditions: "{{ command == '5_hold' }}"
          sequence:
            repeat:
              while: "{{ repeat.index <= 10 }}"
              sequence:
              - service: light.turn_on
                data:
                  entity_id: "{{ light_5 }}"
                  brightness_step_pct: 10
              - delay:
                  milliseconds: 500

        # Dimmer - Lampadario
        - conditions: "{{ command == '6_hold' }}"
          sequence:
            repeat:
              while: "{{ repeat.index <= 10 }}"
              sequence:
              - service: light.turn_on
                data:
                  entity_id: "{{ light_5 }}"
                  brightness_step_pct: -10
              - delay:
                  milliseconds: 500

        # Dimmer + abat_jour
        - conditions: "{{ command == '3_hold' }}"
          sequence:
            repeat:
              while: "{{ repeat.index <= 10 }}"
              sequence:
              - service: light.turn_on
                data:
                  entity_id: "{{ light_6 }}"
                  brightness_step_pct: 10
              - delay:
                  milliseconds: 500
        # Dimmer - abat_jour
        - conditions: "{{ command == '4_hold' }}"
          sequence:
            repeat:
              while: "{{ repeat.index <= 10 }}"
              sequence:
              - service: light.turn_on
                data:
                  entity_id: "{{ light_6 }}"
                  brightness_step_pct: -10
              - delay:
                  milliseconds: 500

        # Dimmer + ingresso
        - conditions: "{{ command == '1_hold' }}"
          sequence:
            repeat:
              while: "{{ repeat.index <= 10 }}"
              sequence:
              - service: light.turn_on
                data:
                  entity_id: "{{ light_7 }}"
                  brightness_step_pct: 10
              - delay:
                  milliseconds: 500
        # Dimmer - ingresso
        - conditions: "{{ command == '2_hold' }}"
          sequence:
            repeat:
              while: "{{ repeat.index <= 10 }}"
              sequence:
              - service: light.turn_on
                data:
                  entity_id: "{{ light_7 }}"
                  brightness_step_pct: -10
              - delay:
                  milliseconds: 500

# Led 1
  - alias: Led 1 Cucina
    id: eb2ef1e793ba96b8808a4d5473593f1c
    mode: single
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_1
          command: 'on'
    action:
      - entity_id: light.led_1_cucina
        service: light.toggle
      - delay: "00:00:01"

  - alias: Led 2 Cucina
    id: 889ad7c683c10c6d0d4e6c6e019efb13
    mode: single
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_2
          command: 'on'
    action:
      - entity_id: light.led_2_cucina
        service: light.toggle
      - delay: "00:00:01"

  - alias: Led Cucina all On/off
    id: c94c142529dc74837a23cfeecdf4aadb
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_1
          command: 'move_with_on_off'
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_2
          command: 'move_with_on_off'
    action:
        - service_template: >
            {% if is_state('light.led_1_cucina', 'on') and  is_state('light.led_2_cucina', 'on') %}
              script.led_cucina_off
            {% else %}
              script.led_cucina_on
            {% endif %}


########################################

  # Telecomando on/off e dimming
  - alias: 'Dimmer Luce Bagno'
    id: fde473c4775cdbd2204fa20169eee356
    mode: restart
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: "00:15:8d:00:02:3d:37:94"
    action:
      - variables:
          command: "{{ trigger.event.data.command }}"
          args: "{{ trigger.event.data.args }}"
          light_dest: light.hue_bagno
      - alias: "Selezione tipo di evento"
        choose:
        # Holt tasto ON (aumenta luminositÃ )
        - conditions: "{{ command == 'hold' }}"
          sequence:
            repeat:
              while: "{{ repeat.index <= 10 }}"
              sequence:
              - service: light.turn_on
                data:
                  entity_id: "{{ light_dest }}"
                  brightness_step_pct: 10
              - delay: 1
