homeassistant:
  customize:
    package.node_anchors:
      customize: &customize
        package: "Package Gestione Luci"
        version: "v3.2 - 29/06/2022"
        author: "Calas"

# Aggiunto: sincronizzazione luci
# Aggiunto: conteggio luci
# Aggiunto: Abbassa / Alaza luci su ogni singola stanza
# Aggiunto: tasto a 6 posizioni
# Aggiunto: Dimmerabilità dai tasti
# Aggiunto: Selettore automatico stanza sa Alexa
# Aggiunto: Gestione transazioni per signolo punto luce
# Aggiunto: popup con gestinone luminosità e scene
# Aggiunto: gestione luce notturna corridoio
# Aggiunto: auto spegnimento luce corridoio
# Aggiunto: personalizzazione da UI durata transazione automatica luci
# Aggiunto: doppo controllo per il passaggio delle fasce orarie
# Aggiunto: personalizzazione da UI durta transazione corta quando si accene la luce
# Aggiunto: personalizzazione da UI durata transazione quando si chiede di alzare o abbassare luci
# Aggiunto: Spegnimento automatico tutte le luci di casa la notte
# Aggiunto: Spengimento automatico luci con l'inserimento allarme away
# Aggiunto: Gestione sincronizzazione luci accese nella stessa stanza dopo la richiesta di alzare o abbassare luci
# Aggiunto: Implementazione percentuale luci con comando vocale
# Aggiunto: Luci al massimo con doppia accensione
# Aggiunto: Riconoscimento ospiti per gestione scene serali

##############################################################################
##                  Input Boolean
###################################################
input_boolean:
  gestione_luci_generale_sincronizzazioni:
    name: "Sincronizzazione"
    icon: mdi:sync

  gestione_luci_tutte:
    name: "Tutte le luci"
    icon: mdi:lightbulb-group

  ################################################### LUCI
  gestione_luci_lampadario_soggiorno:
    name: "Lampadario soggiorno"
    icon: mdi:ceiling-light
  gestione_luci_lampada_soggiorno:
    name: "Lampada soggiorno"
    icon: mdi:floor-lamp
  gestione_luci_cucina:
    name: "Luce cucina"
    icon: mdi:globe-light
  gestione_luci_led_cucina:
    name: "Led cucina"
    icon: mdi:led-strip-variant
  gestione_luci_abat_jour:
    name: "abat_jour"
    icon: mdi:lamp
  gestione_luci_ingresso:
    name: "Luce Ingresso"
    icon: mdi:dome-light
  gestione_luci_corridoio:
    name: "Luce Corridoio"
    icon: mdi:dome-light
  gestione_luci_bagno:
    name: "Luce bagno"
    icon: mdi:lightbulb
  gestione_luci_studio:
    name: "Luce studio"
    icon: mdi:lightbulb
  gestione_luci_cameretta:
    name: "Luce Cameretta"
    icon: mdi:lightbulb
  gestione_luci_camera_da_letto:
    name: "Camera da letto"
    icon: mdi:globe-light

  ############################################### LUCI per alza/Abbassa
  gestione_luci_lampadario_soggiorno_int_sync:
    name: "Lampadario soggiorno int sync"
    icon: mdi:ceiling-light
  gestione_luci_lampada_soggiorno_int_sync:
    name: "Lampada soggiorno int sync"
    icon: mdi:floor-lamp
  gestione_luci_cucina_int_sync:
    name: "Luce cucina int sync"
    icon: mdi:globe-light
  gestione_luci_led_cucina_int_sync:
    name: "Led cucina int sync"
    icon: mdi:led-strip-variant
  gestione_luci_abat_jour_int_sync:
    name: "abat_jour int sync"
    icon: mdi:lamp
  gestione_luci_ingresso_int_sync:
    name: "Luce Ingresso int sync"
    icon: mdi:dome-light
  gestione_luci_corridoio_int_sync:
    name: "Luce Corridoio int sync"
    icon: mdi:dome-light
  gestione_luci_bagno_int_sync:
    name: "Luce bagno int sync"
    icon: mdi:lightbulb
  gestione_luci_studio_int_sync:
    name: "Luce studio int sync"
    icon: mdi:lightbulb
  gestione_luci_cameretta_int_sync:
    name: "Luce Cameretta int sync"
    icon: mdi:lightbulb
  gestione_luci_camera_da_letto_int_sync:
    name: "Camera da letto int sync"
    icon: mdi:globe-light

  gestione_luci_sync_manuale:
    name: "Sync Manuale"

  lampada_go_spegnimento_automatico_notte:
    name: "Spegnimento automatico notte Lampada Go"
    icon: mdi:lightbulb-off
  lampada_go_scena_automatica_notte:
    name: "Scena automatica notte Lampada Go"
    icon: mdi:theme-light-dark

  gestione_luci_periodo_giorno:
    name: "Giorno"
  gestione_luci_periodo_crepuscolo:
    name: "Crepuscolo"
  gestione_luci_periodo_sera:
    name: "Sera"
  gestione_luci_periodo_notte:
    name: "Notte"

  spegni_luci_con_allarme:
    name: Spegni luci con allarme
    icon: mdi:lightbulb-multiple-off

  gestione_luci_alza_luci:
    name: Conditional Card Alza luci
  gestione_luci_abbassa_luci:
    name: Conditional Card Abbassa luci

  gestione_luci_luce_nottura:
    name: Luce nottura corridoio
    icon: mdi:weather-night
  gestione_luci_luce_nottura_off:
    name: Luce nottura corridoio

  gestione_luci_luce_corridoio_auto_off:
    name: Luce corridoio auto off
    icon: mdi:lightbulb-auto-outline

  gestione_luci_tutti_a_letto_lampadario_soggiorno:
    name: "Lampadario soggiorno"
    icon: mdi:ceiling-light
  gestione_luci_tutti_a_letto_lampada_soggiorno:
    name: "Lampada soggiorno"
    icon: mdi:floor-lamp
  gestione_luci_tutti_a_letto_cucina:
    name: "Luce cucina"
    icon: mdi:globe-light
  gestione_luci_tutti_a_letto_abat_jour:
    name: "abat_jour"
    icon: mdi:lamp
  gestione_luci_tutti_a_letto_ingresso:
    name: "Luce Ingresso"
    icon: mdi:dome-light
  gestione_luci_tutti_a_letto_corridoio:
    name: "Luce Corridoio"
    icon: mdi:dome-light
  gestione_luci_tutti_a_letto_bagno:
    name: "Luce bagno"
    icon: mdi:lightbulb
  gestione_luci_tutti_a_letto_studio:
    name: "Luce studio"
    icon: mdi:lightbulb
  gestione_luci_tutti_a_letto_cameretta:
    name: "Luce Cameretta"
    icon: mdi:lightbulb
  gestione_luci_tutti_a_letto_camera_da_letto:
    name: "Camera da letto"
    icon: mdi:globe-light

  gestione_luci_spegnimento_automatico_notte:
    name: "Spegni luci automaticamente di notte"
    icon: mdi:lightbulb-auto-outline

  gestione_luci_sync_percentuale_soggiorno:
    name: Gestione luci sync % Soggiorno
  gestione_luci_sync_percentuale_cucina:
    name: Gestione luci sync % Cucina
  gestione_luci_sync_percentuale_bagno:
    name: Gestione luci sync % Bagno
  gestione_luci_sync_percentuale_studio:
    name: Gestione luci sync % Studio
  gestione_luci_sync_percentuale_cameretta:
    name: Gestione luci sync % Cameretta
  gestione_luci_sync_percentuale_camera_da_letto:
    name: Gestione luci sync % Camera da letto

################################################################################
## Input Number
################################################
input_number:
  gestione_luci_transazione_lunga:
    name: Gestione Luci Transazione Lunga
    icon: mdi:transition
    min: 1
    max: 200
    step: 1
    unit_of_measurement: "sec"

  gestione_luci_transazione_corta:
    name: Gestione Luci Transazione Corta
    icon: mdi:transition-masked
    min: 0
    max: 10
    step: 1
    unit_of_measurement: "sec"

  gestione_luci_transazione_alza_abbassa_luci:
    name: Gestione Luci Transazione Alza/Abbassa
    icon: mdi:circle-opacity
    min: 1
    max: 50
    step: 1
    unit_of_measurement: "sec"

################################################################################
##                  Input Select
###################################################
input_select:
  gestione_luci_base_sync:
    name: "Base"
    icon: mdi:theme-light-dark
    options:
      - "Ora"
      - "Sole"

  gestione_luci_scena_corrente:
    name: "Attuale"
    icon: mdi:progress-clock
    options:
      - "relax"
      - "lettura"
      - "concentrazione"
      - "luce_notturna"
      - "chiaro_di_luna"

  gestione_luci_scena_diurna_sync:
    name: "Mattino"
    icon: mdi:progress-clock
    options:
      - "relax"
      - "lettura"
      - "concentrazione"
      - "luce_notturna"
      - "chiaro_di_luna"

  gestione_luci_scena_crepuscolare_sync:
    name: "Crepuscolo"
    icon: mdi:progress-clock
    options:
      - "relax"
      - "lettura"
      - "concentrazione"
      - "luce_notturna"
      - "chiaro_di_luna"

  gestione_luci_scena_serale_sync:
    name: "Sera"
    icon: mdi:progress-clock
    options:
      - "relax"
      - "lettura"
      - "concentrazione"
      - "luce_notturna"
      - "chiaro_di_luna"

  gestione_luci_scena_notturna_sync:
    name: "Notte"
    icon: mdi:progress-clock
    options:
      - "relax"
      - "lettura"
      - "concentrazione"
      - "luce_notturna"
      - "chiaro_di_luna"

  gestione_luci_scena_corrente_test:
    name: "Attuale"
    icon: mdi:progress-clock
    options:
      - "relax"
      - "lettura"
      - "concentrazione"
      - "luce_notturna"

################################################################################
##                  Input Datetime
###################################################
input_datetime:
  gestione_luci_giorno:
    name: "Inizio Mattino"
    icon: mdi:weather-sunny
    has_time: true
  gestione_luci_giorno_offset:
    name: "Inizio Mattino offset"
    icon: mdi:weather-sunny
    has_time: true

  gestione_luci_crepuscolo:
    name: "Inizio Crepuscolo"
    icon: mdi:weather-sunset
    has_time: true
  gestione_luci_crepuscolo_offset:
    name: "Inizio Crepuscolo offset"
    icon: mdi:weather-sunset
    has_time: true

  gestione_luci_sera:
    name: "Inizio Sera"
    icon: mdi:weather-sunset
    has_time: true
  gestione_luci_sera_offset:
    name: "Inizio Sera offset"
    icon: mdi:weather-sunset
    has_time: true

  gestione_luci_notte:
    name: "Inizio Notte"
    icon: mdi:weather-night
    has_time: true
  gestione_luci_notte_offset:
    name: "Inizio Notte offset"
    icon: mdi:weather-night
    has_time: true

  lampada_go_attivazione_scena_notte:
    name: "Lampada Go modalità notte"
    icon: mdi:weather-night
    has_time: true
  lampada_go_spegnimento_automatico_notte:
    name: "Lampada Go modalità notte"
    icon: mdi:weather-night
    has_time: true

  gestione_luci_spegnimento_automatico_notte:
    name: "Spegni tutte le luci di automatico notte"
    icon: mdi:theme-light-dark
    has_time: true

################################################################################
##                  Input Text
###################################################
input_text:
  gestione_luci_sync_alza_abbassa:
    name: Gestione luci sync alza abbassa

  gestione_luci_sync_percentuale_soggiorno:
    name: Gestione luci sync % Soggiorno
  gestione_luci_sync_percentuale_cucina:
    name: Gestione luci sync % Cucina
  gestione_luci_sync_percentuale_bagno:
    name: Gestione luci sync % Bagno
  gestione_luci_sync_percentuale_studio:
    name: Gestione luci sync % Studio
  gestione_luci_sync_percentuale_cameretta:
    name: Gestione luci sync % Cameretta
  gestione_luci_sync_percentuale_camera_da_letto:
    name: Gestione luci sync % Camera da letto

################################################################################
##                  Sensor
###################################################
sensor:
  - platform: template
    sensors:
      gestione_luci_fascia_oraria_sync:
        friendly_name: "Fascia Oraria"
        value_template: >-
          {% if is_state("input_select.gestione_luci_base_sync", "Ora") %}

            {% if is_state('input_boolean.gestione_luci_periodo_giorno', 'on') %}
              Giorno
            {% elif is_state('input_boolean.gestione_luci_periodo_crepuscolo', 'on') %}
              Crepuscolo
            {% elif is_state('input_boolean.gestione_luci_periodo_sera', 'on') %}
              Sera
            {% elif is_state('input_boolean.gestione_luci_periodo_notte', 'on') %}
              Notte
            {% else %}
              Errore
            {% endif %}

          {% elif is_state("input_select.gestione_luci_base_sync", "Sole") %}

            {% if (as_timestamp(states.sun.sun.attributes.next_dusk)) - (as_timestamp(states.sun.sun.attributes.next_setting)) < 0 %}
              Sera
            {% elif (as_timestamp(states.sun.sun.attributes.next_rising)) - (as_timestamp(states.sun.sun.attributes.next_dawn)) < 0 %}
              Notte
            {% elif (states.sun.sun.attributes.elevation) < -5 %}
              Notte
            {% else %}
              Giorno
            {% endif %}

          {% else %}
            Errore
          {% endif %}
        icon_template: mdi:calendar-clock

      gestione_luci_selettore_stanza:
        friendly_name: "Selettore Stanza"
        value_template: >-
          {% set stanza = states('sensor.last_alexa') %}
          {%- if stanza == "media_player.soggiorno" -%}
            soggiorno
          {%- elif stanza == "media_player.echo_show_cucina" -%}
            cucina
          {%- elif stanza == "media_player.studio" -%}
            studio
          {%- elif stanza == "media_player.camera_da_letto" -%}
            camera_da_letto
          {%- elif stanza == "media_player.bagno" -%}
            bagno
          {%- elif stanza == "media_player.cameretta" -%}
            cameretta
          {% else %}
            Errore
          {% endif %}
        icon_template: mdi:floor-plan

      gestione_luci_scena_corrente:
        friendly_name: Scena Corrente
        value_template: >
          {{ states('input_select.gestione_luci_scena_corrente') }}

      luci_accese:
        friendly_name: "Luci Accese"
        icon_template: "mdi:lightbulb-group-outline"
        value_template: "{{ expand('group.tutte_le_luci') | selectattr('state', 'eq', 'on') | list | count }}"

      gestione_luci_conteggio_luci_soggiorno:
        friendly_name: "Numero luci accese soggiorno"
        value_template: >
          {{expand('group.tutte_le_luci')
              | selectattr('entity_id', 'in', area_entities('soggiorno'))
              | selectattr('state', 'eq', 'on')
              | map(attribute='entity_id')
              | list
              | count
          }}
      gestione_luci_conteggio_luci_cucina:
        friendly_name: "Numero luci accese cucina"
        value_template: >
          {{expand('group.tutte_le_luci')
              | selectattr('entity_id', 'in', area_entities('cucina'))
              | selectattr('state', 'eq', 'on')
              | map(attribute='entity_id')
              | list
              | count
          }}
      gestione_luci_conteggio_luci_bagno:
        friendly_name: "Numero luci accese bagno"
        value_template: >
          {{expand('group.tutte_le_luci')
              | selectattr('entity_id', 'in', area_entities('bagno grande'))
              | selectattr('state', 'eq', 'on')
              | map(attribute='entity_id')
              | list
              | count
          }}
      gestione_luci_conteggio_luci_ingresso:
        friendly_name: "Numero luci accese ingresso"
        value_template: >
          {{expand('group.tutte_le_luci')
              | selectattr('entity_id', 'in', area_entities('ingresso'))
              | selectattr('state', 'eq', 'on')
              | map(attribute='entity_id')
              | list
              | count
          }}
      gestione_luci_conteggio_luci_corridoio:
        friendly_name: "Numero luci accese corridoio"
        value_template: >
          {{expand('group.tutte_le_luci')
              | selectattr('entity_id', 'in', area_entities('corridoio'))
              | selectattr('state', 'eq', 'on')
              | map(attribute='entity_id')
              | list
              | count
          }}
      gestione_luci_conteggio_luci_studio:
        friendly_name: "Numero luci accese studio"
        value_template: >
          {{expand('group.tutte_le_luci')
              | selectattr('entity_id', 'in', area_entities('studio'))
              | selectattr('state', 'eq', 'on')
              | map(attribute='entity_id')
              | list
              | count
          }}
      gestione_luci_conteggio_luci_cameretta:
        friendly_name: "Numero luci accese cameretta"
        value_template: >
          {{expand('group.tutte_le_luci')
              | selectattr('entity_id', 'in', area_entities('cameretta'))
              | selectattr('state', 'eq', 'on')
              | map(attribute='entity_id')
              | list
              | count
          }}
      gestione_luci_conteggio_luci_camera_da_letto:
        friendly_name: "Numero luci accese camera da letto"
        value_template: >
          {{expand('group.tutte_le_luci')
              | selectattr('entity_id', 'in', area_entities('camera da letto'))
              | selectattr('state', 'eq', 'on')
              | map(attribute='entity_id')
              | list
              | count
          }}

################################################################################
##                  Group
###################################################
group:
  tutte_le_luci: # Serve per il conteggio delle luci accese
    entities:
      - light.luce_ingresso
      - light.luce_corridoio
      - light.luce_cucina
      - light.luce_balcone_cucina
      - light.led_1_cucina
      - light.hue_led_cucina
      - light.soggiorno_luce_piccola
      - light.soggiorno_luce_grande
      - light.luce_abat_jour
      - light.lampada_sale
      - light.luce_bagno
      - light.luce_studio
      - light.luce_cameretta
      - light.hue_go
      - light.luce_camera_da_letto
      - light.luce_lampada_soggiorno

  luci:
    name: luci per sensore tutti a letto
    entities:
      - light.luce_ingresso
      - light.luce_corridoio
      - light.luce_cucina
      - light.luce_balcone_cucina
      - light.led_1_cucina
      - light.hue_led_cucina
      - light.soggiorno_luce_piccola
      - light.soggiorno_luce_grande
      - light.luce_abat_jour
      - light.luce_bagno
      - light.luce_studio
      - light.luce_cameretta
      - light.luce_camera_da_letto
      - light.luce_lampada_soggiorno

  luci_hue:
    name: tutte le HUE
    entities:
      - light.hue_abat_jour
      - light.hue_bagno
      - light.hue_cameretta
      - light.hue_corridoio
      - light.hue_go
      - light.hue_lampada_soggiorno
      - light.hue_lampadina1_lampdario
      - light.hue_lampadina_2_lampadario
      - light.hue_lampadina_3_lampadario
      - light.hue_luce_cucina
      - light.hue_luce_ingresso
      - light.hue_luce_cucina
      - light.hue_room_cucina_3
      - light.hue_camera_da_letto

light:
  - platform: group
    name: Tutte le luci
    entities:
      - light.luce_ingresso
      - light.luce_corridoio
      - light.luce_cucina
      - light.luce_balcone_cucina
      - light.led_1_cucina
      - light.hue_led_cucina
      - light.soggiorno_luce_piccola
      - light.soggiorno_luce_grande
      - light.luce_abat_jour
      - light.lampada_sale
      - light.luce_bagno
      - light.luce_studio
      - light.luce_cameretta
      - light.luce_camera_da_letto
      - light.luce_lampada_soggiorno

################################################################################
##                  Timer
###################################################
timer:
  gesione_luci_timer_max_lampadario_soggiorno:
    duration: "00:00:02"
  gesione_luci_timer_max_led_cucina:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_cucina:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_abat_jour:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_bagno:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_ingresso:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_corridoio:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_studio:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_cameretta:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_lampada_soggiorno:
    duration: "00:00:02"
  gesione_luci_timer_max_luce_camera_da_letto:
    duration: "00:00:02"

################################################################################
##                  Script
###################################################
script:
  luci_sync:
    alias: "Sync Modello Attuale"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id:
          - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
          - input_boolean.gestione_luci_lampada_soggiorno_int_sync
          - input_boolean.gestione_luci_cucina_int_sync
          - input_boolean.gestione_luci_led_cucina_int_sync
          - input_boolean.gestione_luci_bagno_int_sync
          - input_boolean.gestione_luci_abat_jour_int_sync
          - input_boolean.gestione_luci_ingresso_int_sync
          - input_boolean.gestione_luci_corridoio_int_sync
          - input_boolean.gestione_luci_studio_int_sync
          - input_boolean.gestione_luci_cameretta_int_sync
          - input_boolean.gestione_luci_camera_da_letto_int_sync

      - service: script.turn_on
        entity_id:
          - script.gestione_luci_sync_lampadario_soggiorno
          - script.gestione_luci_sync_lampada_soggiorno
          - script.gestione_luci_sync_led_cucina
          - script.gestione_luci_sync_luce_cucina
          - script.gestione_luci_sync_bagno
          - script.gestione_luci_sync_abat_jour
          - script.gestione_luci_ingresso
          - script.gestione_luci_corridoio
          - script.gestione_luci_studio
          - script.gestione_luci_cameretta

  ######################################### Script Luci Transazione Lunga
  gestione_luci_sync_tutte_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_tutte
        state: "on"
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
        target:
          entity_id: "scene.hue_room_tutte_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_sync_lampadario_soggiorno_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_lampadario_soggiorno
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_lampadario_soggiorno_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - if: "{{ states('input_boolean.gestione_luci_lampadario_soggiorno_int_sync') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
            else:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_lettura"

  gestione_luci_sync_lampada_soggiorno_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_lampada_soggiorno
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_lampada_soggiorno_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - if: "{{ states('input_boolean.gestione_luci_lampada_soggiorno_int_sync') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
            else:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_lettura"

  gestione_luci_sync_abat_jour_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_abat_jour
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_abat_jour_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - if: "{{ states('input_boolean.gestione_luci_abat_jour_int_sync') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
            else:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.abat_jour_lettura"

  gestione_luci_sync_led_cucina_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_led_cucina
        state: "on"
      - condition: state
        entity_id: light.hue_led_cucina
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_led_cucina_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - if: "{{ states('input_boolean.gestione_luci_led_cucina_int_sync') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
            else:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_lettura"

  gestione_luci_sync_luce_cucina_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_cucina
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_cucina_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - if: "{{ states('input_boolean.gestione_luci_cucina_int_sync') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
            else:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.cucina_lettura"

  gestione_luci_sync_bagno_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_bagno
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_bagno_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
            target:
              entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.bagno_lettura"

  gestione_luci_ingresso_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_ingresso
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_ingresso_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
            target:
              entity_id: "scene.ingresso_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.ingresso_lettura"

  gestione_luci_corridoio_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_corridoio
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_corridoio_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
            target:
              entity_id: "scene.corridoio_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.corridoio_lettura"

  gestione_luci_studio_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_studio
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_studio_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
            target:
              entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.studio_lettura"

  gestione_luci_cameretta_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_cameretta
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
            target:
              entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.cameretta_lettura"

  gestione_luci_camera_da_letto_transazione_lunga:
    alias: "Sincronizzazione Modello Attuale camera da letto lunga"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_camera_da_letto
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
        state: "on"
      - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
        then:
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
            target:
              entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
        else:
          - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_lunga') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_lettura"

  ######################################### Script Luci Transazione Corta
  gestione_luci_sync_tutte:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_tutte
        state: "on"
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
        target:
          entity_id: "scene.hue_room_tutte_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_sync_lampadario_soggiorno:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_lampadario_soggiorno
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_lampadario_soggiorno') == 'active' }}"
        then:
          - service: input_boolean.turn_off
            entity_id:
              - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
              - input_boolean.gestione_luci_lampada_soggiorno_int_sync
              - input_boolean.gestione_luci_abat_jour_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.lampadario_soggiorno_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - if: "{{ states('input_boolean.gestione_luci_sync_percentuale_soggiorno') == 'on' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      brightness: "{{states('input_text.gestione_luci_sync_percentuale_soggiorno') }}"
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
                else:
                  - if: "{{ states('input_boolean.gestione_luci_lampadario_soggiorno_int_sync') == 'off' }}"
                    then:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.lampadario_soggiorno_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
                    else:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.lampadario_soggiorno_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_sync_lampada_soggiorno:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_lampada_soggiorno
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_lampada_soggiorno') == 'active' }}"
        then:
          - service: input_boolean.turn_off
            entity_id:
              - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
              - input_boolean.gestione_luci_lampada_soggiorno_int_sync
              - input_boolean.gestione_luci_abat_jour_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.lampada_soggiorno_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - if: "{{ states('input_boolean.gestione_luci_sync_percentuale_soggiorno') == 'on' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      brightness: "{{states('input_text.gestione_luci_sync_percentuale_soggiorno') }}"
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
                else:
                  - if: "{{ states('input_boolean.gestione_luci_lampada_soggiorno_int_sync') == 'off' }}"
                    then:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.lampada_soggiorno_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
                    else:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.lampada_soggiorno_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_sync_abat_jour:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_abat_jour
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_abat_jour') == 'active' }}"
        then:
          - service: input_boolean.turn_off
            entity_id:
              - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
              - input_boolean.gestione_luci_lampada_soggiorno_int_sync
              - input_boolean.gestione_luci_abat_jour_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.abat_jour_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - if: "{{ states('input_boolean.gestione_luci_sync_percentuale_soggiorno') == 'on' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      brightness: "{{states('input_text.gestione_luci_sync_percentuale_soggiorno') }}"
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
                else:
                  - if: "{{ states('input_boolean.gestione_luci_abat_jour_int_sync') == 'off' }}"
                    then:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.abat_jour_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
                    else:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.abat_jour_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_sync_led_cucina:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - delay:
          milliseconds: 600
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_led_cucina
        state: "on"
      - condition: state
        entity_id: light.hue_led_cucina
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_led_cucina') == 'active' }}" ################
        then:
          - service: input_boolean.turn_off
            entity_id:
              - input_boolean.gestione_luci_cucina_int_sync
              - input_boolean.gestione_luci_led_cucina_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.hue_room_led_cucina_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - if: "{{ states('input_boolean.gestione_luci_sync_percentuale_cucina') == 'on' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      brightness: "{{states('input_text.gestione_luci_sync_percentuale_cucina') }}"
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
                else:
                  - if: "{{ states('input_boolean.gestione_luci_led_cucina_int_sync') == 'off' }}"
                    then:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.hue_room_led_cucina_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
                    else:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.hue_room_led_cucina_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_sync_luce_cucina:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_cucina
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_cucina') == 'active' }}" ################
        then:
          - service: input_boolean.turn_off
            entity_id:
              - input_boolean.gestione_luci_cucina_int_sync
              - input_boolean.gestione_luci_led_cucina_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.cucina_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - if: "{{ states('input_boolean.gestione_luci_sync_percentuale_cucina') == 'on' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      brightness: "{{states('input_text.gestione_luci_sync_percentuale_cucina') }}"
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
                else:
                  - if: "{{ states('input_boolean.gestione_luci_cucina_int_sync') == 'off' }}"
                    then:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.cucina_{{ states('input_text.gestione_luci_sync_alza_abbassa')}}"
                    else:
                      - service: hue.activate_scene
                        data:
                          transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                        target:
                          entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.cucina_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_sync_bagno:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_bagno
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_bagno') == 'active' }}" ################
        then:
          - service: input_boolean.turn_off
            entity_id: input_boolean.gestione_luci_bagno_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.bagno_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.bagno_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_ingresso:
    alias: "Sincronizzazione Modello Attuale"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_ingresso
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_ingresso') == 'active' }}" ################
        then:
          - service: input_boolean.turn_off
            entity_id: input_boolean.gestione_luci_ingresso_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.ingresso_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.ingresso_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.ingresso_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.ingresso_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_corridoio:
    alias: "Sincronizzazione Modello Attuale corridoio"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_corridoio
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_corridoio') == 'active' }}" ################
        then:
          - service: input_boolean.turn_off
            entity_id: input_boolean.gestione_luci_corridoio_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.corridoio_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.corridoio_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.corridoio_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.corridoio_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_studio:
    alias: "Sincronizzazione Modello Attuale studio"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_studio
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_studio') == 'active' }}" ################
        then:
          - service: input_boolean.turn_off
            entity_id: input_boolean.gestione_luci_studio_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.studio_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.studio_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"

  gestione_luci_cameretta:
    alias: "Sincronizzazione Modello Attuale cameretta"
    icon: mdi:palette
    sequence:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_cameretta
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_cameretta') == 'active' }}" ################
        then:
          - service: input_boolean.turn_off
            entity_id: input_boolean.gestione_luci_cameretta_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.cameretta_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.cameretta_lettura"

  gestione_luci_camera_da_letto:
    alias: "Sincronizzazione Modello Attuale camera da letto corta"
    icon: mdi:palette
    sequence:
      - delay:
          milliseconds: 900
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
      - condition: state
        entity_id: input_boolean.gestione_luci_camera_da_letto
        state: "on"
      - if: "{{ states('timer.gesione_luci_timer_max_luce_camera_da_letto') == 'active' }}"
        then:
          - service: input_boolean.turn_off
            entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
          - service: hue.activate_scene
            data:
              transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
            target:
              entity_id: "scene.camera_da_letto_lettura"
        else:
          - if: "{{ states('input_boolean.modo_ospite') == 'off' }}"
            then:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
            else:
              - if: "{{ states('sensor.gestione_luci_fascia_oraria_sync') != 'Giorno' }}"
                then:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.camera_da_letto_lettura"
                else:
                  - service: hue.activate_scene
                    data:
                      transition: "{{states('input_number.gestione_luci_transazione_corta') |int }}"
                    target:
                      entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"

  ######################################### FINE Script Luci Transazione Corta

  ######################################## Percentuale %
  gestione_luci_percentuale_10:
    alias: "Gestione Luci 10%"
    icon: mdi:lightbulb-on-10
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "25"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "25"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "25"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "25"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "25"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 25
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "25"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_20:
    alias: "Gestione Luci 20%"
    icon: mdi:lightbulb-on-20
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "51"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "51"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "51"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "51"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "51"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 51
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "51"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_30:
    alias: "Gestione Luci 30%"
    icon: mdi:lightbulb-on-30
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "76"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "76"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "76"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "76"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "76"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 76
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "76"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_40:
    alias: "Gestione Luci 40%"
    icon: mdi:lightbulb-on-40
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "102"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "102"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "102"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "102"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "102"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 102
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "102"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_50:
    alias: "Gestione Luci 50%"
    icon: mdi:lightbulb-on-50
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "127"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "127"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "127"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "127"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "127"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 127
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "127"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_60:
    alias: "Gestione Luci 60%"
    icon: mdi:lightbulb-on-60
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "153"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "153"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "153"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "153"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "153"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 153
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "153"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_70:
    alias: "Gestione Luci 70%"
    icon: mdi:lightbulb-on-70
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "178"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "178"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "178"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "178"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "178"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 178
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "178"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_80:
    alias: "Gestione Luci 80%"
    icon: mdi:lightbulb-on-80
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "204"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "204"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "204"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "204"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "204"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 204
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "204"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_90:
    alias: "Gestione Luci 90%"
    icon: mdi:lightbulb-on-90
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "229"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "229"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "229"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "229"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "229"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 229
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "229"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  gestione_luci_percentuale_100:
    alias: "Gestione Luci 100%"
    icon: mdi:lightbulb-on-100
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions: # Soggiorno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','soggiorno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampadario_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.lampada_soggiorno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.abat_jour_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_soggiorno
                data:
                  value: "225"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno

          - conditions: # Cucina
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','cucina')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cucina_int_sync
              - condition: state
                entity_id: light.hue_led_cucina
                state: "on"
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.hue_room_led_cucina_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cucina
                data:
                  value: "225"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina

          - conditions: # Bagno
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.bagno_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_bagno
                data:
                  value: "225"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno

          - conditions: # Studio
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.studio_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_studio
                data:
                  value: "225"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio

          - conditions: # Cameretta
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','bagno')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.cameretta_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_cameretta
                data:
                  value: "225"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta

          - conditions: # Camera da letto
              - condition: template
                value_template: "{{is_state('sensor.gestione_luci_selettore_stanza','camera_da_letto')}}"
            sequence:
              - service: hue.activate_scene
                data:
                  brightness: 255
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: "scene.camera_da_letto_{{ states('input_select.gestione_luci_scena_corrente')}}"
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_text.set_value
                target:
                  entity_id: input_text.gestione_luci_sync_percentuale_camera_da_letto
                data:
                  value: "225"
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  ######################################### FINE Percentuale %
  gestione_luci_riattiva_sync:
    alias: "Riattiva Sincronizzazione automatica"
    icon: mdi:sync-circle
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_tutte
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni

  gestione_luci_stop_sync:
    alias: "Ferma Sincronizzazione automatica"
    icon: mdi:sync-off
    sequence:
      - service: input_boolean.turn_off
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni

  gestione_luci_alza_luminosita:
    alias: "Luci al massimo"
    icon: mdi:sync-alert
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - service: hue.hue_activate_scene
        data_template:
          group_name: "{{states('sensor.gestione_luci_selettore_stanza') }}"
          scene_name: "Lettura"
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"

  ################################################### Alccendi/Spegni Luci Stanza
  gestione_luci_spegni_luci_stanza:
    alias: "Spegni luci selezione stanza automatica"
    icon: mdi:sync-alert
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'soggiorno' }}"
            sequence:
              - delay: 5
              - service: light.turn_off
                data:
                  entity_id: light.soggiorno_luce_piccola,light.soggiorno_luce_grande,light.luce_abat_jour,light.lampada_sale,light.luce_lampada_soggiorno,light.luce_ingresso

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'cucina' }}"
            sequence:
              - delay: 5
              - service: light.turn_off
                data:
                  entity_id: light.luce_cucina,light.led_1_cucina,light.led_2_cucina

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'camera_da_letto' }}"
            sequence:
              - service: light.turn_off
                data:
                  entity_id: light.luce_camera_da_letto

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'studio' }}"
            sequence:
              - service: light.turn_off
                data:
                  entity_id: light.luce_studio

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'cameretta' }}"
            sequence:
              - service: light.turn_off
                data:
                  entity_id: light.luce_cameretta

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'bagno' }}"
            sequence:
              - service: light.turn_off
                data:
                  entity_id: light.luce_bagno

  gestione_luci_accendi_luci_stanza:
    alias: "Accendi luci selezione stanza automatica"
    icon: mdi:sync-alert
    sequence:
      - service: alexa_media.update_last_called
      - delay:
          milliseconds: 500
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'soggiorno' }}"
            sequence:
              - service: light.turn_on
                data:
                  entity_id: light.soggiorno_luce_piccola,light.soggiorno_luce_grande,light.luce_abat_jour,light.lampada_sale,light.luce_lampada_soggiorno,light.luce_ingresso

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'cucina' }}"
            sequence:
              - service: light.turn_on
                data:
                  entity_id: light.luce_cucina,light.led_1_cucina,light.led_2_cucina

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'camera_da_letto' }}"
            sequence:
              - service: light.turn_on
                data:
                  entity_id: light.luce_camera_da_letto

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'studio' }}"
            sequence:
              - service: light.turn_on
                data:
                  entity_id: light.luce_studio

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'cameretta' }}"
            sequence:
              - service: light.turn_on
                data:
                  entity_id: light.luce_cameretta

          - conditions:
              - condition: template
                value_template: "{{ states('sensor.gestione_luci_selettore_stanza') ==  'bagno' }}"
            sequence:
              - service: light.turn_on
                data:
                  entity_id: light.luce_bagno

  ################################################### Abbassa Luci
  gestione_luci_abbassa_luci:
    alias: "Abbassa luci"
    icon: mdi:palette
    sequence:
      - service: alexa_media.update_last_called
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: "scene.{{states('sensor.gestione_luci_selettore_stanza')}}_galassia"

      - service: input_text.set_value
        target:
          entity_id: input_text.gestione_luci_sync_alza_abbassa
        data:
          value: "galassia"

      - choose:
          - conditions: "{{ is_state('light.hue_led_cucina', 'on') and states('sensor.gestione_luci_selettore_stanza') == 'cucina' }}"
            sequence:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: scene.hue_room_led_cucina_galassia

      - choose:
          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'soggiorno'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'cucina'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_cucina_int_sync
                  - input_boolean.gestione_luci_led_cucina_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'bagno'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'studio'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'cameretta'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'camera_da_letto'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync

  gestione_luci_abbassa_luci_soggiorno:
    alias: "Abbassa luci soggiorno"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.soggiorno_galassia
      - service: input_boolean.turn_off
        entity_id:
          - input_boolean.gestione_luci_lampadario_soggiorno
          - input_boolean.gestione_luci_lampada_soggiorno
          - input_boolean.gestione_luci_abat_jour

  gestione_luci_abbassa_luci_cucina:
    alias: "Abbassa luci cucina"
    icon: mdi:palette
    sequence:
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.cucina_galassia
      - condition: template
        value_template: "{{ is_state('light.hue_led_cucina', 'on') }}"
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.hue_room_led_cucina_galassia

  gestione_luci_abbassa_luci_led_cucina:
    alias: "Abbassa luci cucina"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.hue_room_led_cucina_galassia

  gestione_luci_abbassa_luci_ingresso:
    alias: "Abbassa luci Ingresso"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.ingresso_galassia

  gestione_luci_abbassa_luci_corridoio:
    alias: "Abbassa luci Corridoio"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.corridoio_galassia

  gestione_luci_abbassa_luci_studio:
    alias: "Abbassa luci studio"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.studio_galassia

  gestione_luci_abbassa_luci_camera_da_letto:
    alias: "Abbassa luci Camera da letto"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.camera_da_letto_galassia

  gestione_luci_abbassa_luci_cameretta:
    alias: "Abbassa luci Cameretta"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: alexa_media.update_last_called
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.cameretta_galassia

  gestione_luci_abbassa_luci_bagno:
    alias: "Abbassa luci bagno"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.bagno_galassia

  ################################################### Alza Luci
  gestione_luci_alza_luci:
    alias: "Alza Luci"
    icon: mdi:palette
    sequence:
      - service: alexa_media.update_last_called

      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: "scene.{{states('sensor.gestione_luci_selettore_stanza')}}_lettura"

      - service: input_text.set_value
        target:
          entity_id: input_text.gestione_luci_sync_alza_abbassa
        data:
          value: "lettura"

      - choose:
          - conditions: "{{ is_state('light.hue_led_cucina', 'on') and states('sensor.gestione_luci_selettore_stanza') == 'cucina' }}"
            sequence:
              - service: hue.activate_scene
                data:
                  transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
                target:
                  entity_id: scene.hue_room_led_cucina_lettura

      - choose:
          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'soggiorno'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'cucina'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_cucina_int_sync
                  - input_boolean.gestione_luci_led_cucina_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'bagno'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_bagno_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'studio'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_studio_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'cameretta'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_cameretta_int_sync

          - conditions:
              - condition: template
                value_template: "{{states('sensor.gestione_luci_selettore_stanza') == 'camera_da_letto'}}"
            sequence:
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_camera_da_letto_int_sync

  gestione_luci_alza_luci_soggiorno:
    alias: "Alza luci soggiorno"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.soggiorno_lettura
      - service: input_boolean.turn_off
        entity_id:
          - input_boolean.gestione_luci_lampadario_soggiorno
          - input_boolean.gestione_luci_lampada_soggiorno
          - input_boolean.gestione_luci_abat_jour

  gestione_luci_alza_luci_cucina:
    alias: "Alza luci cucina"
    icon: mdi:palette
    sequence:
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.cucina_lettura
      - condition: template
        value_template: "{{ is_state('light.hue_led_cucina', 'on') }}"
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.hue_room_led_cucina_lettura

  gestione_luci_alza_luci_led_cucina:
    alias: "Alza luci cucina"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale

      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.hue_room_led_cucina_lettura

  gestione_luci_alza_luci_ingresso:
    alias: "Alza luci Ingresso"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.ingresso_lettura

  gestione_luci_alza_luci_corridoio:
    alias: "Alza luci Corridoio"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.corridoio_lettura

  gestione_luci_alza_luci_studio:
    alias: "Alza luci studio"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.studio_lettura

  gestione_luci_alza_luci_camera_da_letto:
    alias: "Alza luci Camera da letto"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.camera_da_letto_lettura

  gestione_luci_alza_luci_cameretta:
    alias: "Alza luci Cameretta"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.cameretta_lettura

  gestione_luci_alza_luci_bagno:
    alias: "Alza luci bagno"
    icon: mdi:palette
    sequence:
      - service: input_boolean.turn_on
        entity_id: input_boolean.gestione_luci_sync_manuale
      - service: hue.activate_scene
        data:
          transition: "{{states('input_number.gestione_luci_transazione_alza_abbassa_luci') |int }}"
        target:
          entity_id: scene.bagno_lettura

  alexa_actions_gestione_ospiti:
    sequence:
      - service: script.activate_alexa_actionable_notification
        data_template:
          text: "Scusate, prima che abbassi le luci come previsto, ho visto che ci sono ospiti. Attivo la modalità ospite?"
          event_id: "actionable_notification_gestione_luci_ospite"
          alexa_device: "media_player.soggiorno"

################################################################################
##                  Template
###################################################
template:
  - binary_sensor:
      - name: gestione luci gruppo sync
        state: >
          {{ is_state('input_boolean.gestione_luci_lampadario_soggiorno', 'on')
            and is_state('input_boolean.gestione_luci_lampada_soggiorno', 'on')
            and is_state('input_boolean.gestione_luci_cucina', 'on')
            and is_state('input_boolean.gestione_luci_led_cucina', 'on')
            and is_state('input_boolean.gestione_luci_abat_jour', 'on')
            and is_state('input_boolean.gestione_luci_ingresso', 'on')
            and is_state('input_boolean.gestione_luci_corridoio', 'on')
            and is_state('input_boolean.gestione_luci_studio', 'on')
            and is_state('input_boolean.gestione_luci_bagno', 'on')
            and is_state('input_boolean.gestione_luci_cameretta', 'on')
            and is_state('input_boolean.gestione_luci_camera_da_letto', 'on') }}

################################################################################
##                  Automation
###################################################
automation:
  - alias: "gestione_luci_set_offset_fascia_oraria"
    id: 452240bc8f1cef6c87dc5bb7ee7ae2b0
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: input_datetime.gestione_luci_giorno
      - platform: state
        entity_id: input_datetime.gestione_luci_crepuscolo
      - platform: state
        entity_id: input_datetime.gestione_luci_sera
      - platform: state
        entity_id: input_datetime.gestione_luci_notte
    action:
      - variables:
          variabile: "{{ trigger.entity_id }}"
      - alias: "selettore"
        choose:
          - conditions: "{{ variabile == 'input_datetime.gestione_luci_giorno' }}"
            sequence:
              - service: input_datetime.set_datetime
                target:
                  entity_id: input_datetime.gestione_luci_giorno_offset
                data:
                  time: "{{(state_attr('input_datetime.gestione_luci_giorno', 'timestamp') + 600) | timestamp_custom('%H:%M', false)}}"

          - conditions: "{{ variabile == 'input_datetime.gestione_luci_crepuscolo' }}"
            sequence:
              - service: input_datetime.set_datetime
                target:
                  entity_id: input_datetime.gestione_luci_crepuscolo_offset
                data:
                  time: "{{(state_attr('input_datetime.gestione_luci_crepuscolo', 'timestamp') + 600) | timestamp_custom('%H:%M', false)}}"

          - conditions: "{{ variabile == 'input_datetime.gestione_luci_sera' }}"
            sequence:
              - service: input_datetime.set_datetime
                target:
                  entity_id: input_datetime.gestione_luci_sera_offset
                data:
                  time: "{{(state_attr('input_datetime.gestione_luci_sera', 'timestamp') + 600) | timestamp_custom('%H:%M', false)}}"

          - conditions: "{{ variabile == 'input_datetime.gestione_luci_notte' }}"
            sequence:
              - service: input_datetime.set_datetime
                target:
                  entity_id: input_datetime.gestione_luci_notte_offset
                data:
                  time: "{{(state_attr('input_datetime.gestione_luci_notte', 'timestamp') + 600) | timestamp_custom('%H:%M', false)}}"

  - alias: "gestione_luci_set_fascia_oraria"
    id: 01FH6198R9VKMN775EADTRAZXP
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: time
        at: input_datetime.gestione_luci_giorno
      - platform: time
        at: input_datetime.gestione_luci_crepuscolo
      - platform: time
        at: input_datetime.gestione_luci_sera
      - platform: time
        at: input_datetime.gestione_luci_notte
      - platform: time
        at: input_datetime.gestione_luci_giorno_offset
      - platform: time
        at: input_datetime.gestione_luci_crepuscolo_offset
      - platform: time
        at: input_datetime.gestione_luci_sera_offset
      - platform: time
        at: input_datetime.gestione_luci_notte_offset
    action:
      - choose:
          - alias: "se mattino"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_giorno') [0:5] }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_giorno
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_sera
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se mattino offset"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_giorno_offset') [0:5] }}"
              - condition: template
                value_template: "{{is_state('input_boolean.gestione_luci_periodo_giorno','off') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_giorno
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_sera
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se crepuscolo"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_crepuscolo') [0:5] }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_crepuscolo
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_sera
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se crepuscolo offset"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_crepuscolo_offset') [0:5] }}"
              - condition: template
                value_template: "{{is_state('input_boolean.gestione_luci_periodo_crepuscolo','off') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_crepuscolo
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_sera
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se sera"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_sera') [0:5] }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_sera
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se sera offset"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_sera_offset') [0:5] }}"
              - condition: template
                value_template: "{{is_state('input_boolean.gestione_luci_periodo_sera','off') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_sera
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_notte

          - alias: "se notte"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_notte') [0:5] }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_notte
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_sera

          - alias: "se notte offset"
            conditions:
              - condition: template
                value_template: "{{states('sensor.time') == states('input_datetime.gestione_luci_notte_offset') [0:5] }}"
              - condition: template
                value_template: "{{is_state('input_boolean.gestione_luci_periodo_notte','off') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id: input_boolean.gestione_luci_periodo_notte
              - service: input_boolean.turn_off
                entity_id:
                  - input_boolean.gestione_luci_periodo_giorno
                  - input_boolean.gestione_luci_periodo_crepuscolo
                  - input_boolean.gestione_luci_periodo_sera

  ################################################### SELETTORE GRUPPI
  - alias: "Gestione_luci_selezione_gruppi_tutte"
    id: 77dc3309b4214f3a7c8c60cce45c1b1e
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: input_boolean.gestione_luci_tutte
        to: "on"
    action:
      - service: input_boolean.turn_on
        entity_id:
          - input_boolean.gestione_luci_lampadario_soggiorno
          - input_boolean.gestione_luci_lampada_soggiorno
          - input_boolean.gestione_luci_cucina
          - input_boolean.gestione_luci_led_cucina
          - input_boolean.gestione_luci_bagno
          - input_boolean.gestione_luci_abat_jour
          - input_boolean.gestione_luci_ingresso
          - input_boolean.gestione_luci_corridoio
          - input_boolean.gestione_luci_studio
          - input_boolean.gestione_luci_cameretta
          - input_boolean.gestione_luci_camera_da_letto
          - input_boolean.lampada_go_spegnimento_automatico_notte
          - input_boolean.lampada_go_scena_automatica_notte

  - alias: "Gestione_luci_selezione_gruppi_tutte_off"
    id: f0eac9f89913bff1162960e671d81f20
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: binary_sensor.gestione_luci_gruppo_sync
        to: "off"
    action:
      - service: input_boolean.turn_off
        entity_id:
          - input_boolean.gestione_luci_tutte

  - alias: "Gestione_luci_selezione_gruppi_tutte_on"
    id: 3419f0195bc617c35580d481090fb4b0
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: binary_sensor.gestione_luci_gruppo_sync
        to: "on"
    action:
      - service: input_boolean.turn_on
        entity_id:
          - input_boolean.gestione_luci_tutte

  ################################################### FINE SELETTORE GRUPPI
  - alias: "gestione_luci_sync_impostazioni"
    id: 01FGFMDMV59Q1AXQ5ETBFWP9HG
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id: sensor.gestione_luci_fascia_oraria_sync
    action:
      - service: input_select.select_option
        data_template:
          entity_id: input_select.gestione_luci_scena_corrente
          option: >-
            {% if is_state("sensor.gestione_luci_fascia_oraria_sync", "Giorno") %}
              {{ states("input_select.gestione_luci_scena_diurna_sync") }}

            {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Crepuscolo") %}
              {{ states("input_select.gestione_luci_scena_crepuscolare_sync") }}

            {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Sera") %}
              {{ states("input_select.gestione_luci_scena_serale_sync") }}

            {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Notte") %}
              {{ states("input_select.gestione_luci_scena_notturna_sync") }}

            {% else %}
              {{ states("input_select.gestione_luci_scena_diurna_sync") }}
            {% endif %}

  - alias: "gestione_luci_sync"
    id: 4fb51affa86ed9b1e1ed5849826896df
    initial_state: true
    mode: single
    max_exceeded: silent
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id:
          - input_boolean.gestione_luci_generale_sincronizzazioni

          - input_datetime.gestione_luci_giorno
          - input_datetime.gestione_luci_crepuscolo
          - input_datetime.gestione_luci_sera
          - input_datetime.gestione_luci_notte

          - input_select.gestione_luci_base_sync
          - input_select.gestione_luci_scena_corrente
          - input_select.gestione_luci_scena_diurna_sync
          - input_select.gestione_luci_scena_crepuscolare_sync
          - input_select.gestione_luci_scena_serale_sync
          - input_select.gestione_luci_scena_notturna_sync

          - input_boolean.gestione_luci_lampadario_soggiorno
          - input_boolean.gestione_luci_lampada_soggiorno
          - input_boolean.gestione_luci_cucina
          - input_boolean.gestione_luci_led_cucina
          - input_boolean.gestione_luci_abat_jour
          - input_boolean.gestione_luci_ingresso
          - input_boolean.gestione_luci_corridoio
          - input_boolean.gestione_luci_bagno
          - input_boolean.gestione_luci_studio
          - input_boolean.gestione_luci_cameretta
          - input_boolean.gestione_luci_camera_da_letto
    condition:
      - condition: state
        entity_id: input_boolean.gestione_luci_generale_sincronizzazioni
        state: "on"
    action:
      - service: input_select.select_option
        data_template:
          entity_id: input_select.gestione_luci_scena_corrente
          option: >-
            {% if is_state("sensor.gestione_luci_fascia_oraria_sync", "Giorno") %}
              {{ states("input_select.gestione_luci_scena_diurna_sync") }}

            {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Crepuscolo") %}
              {{ states("input_select.gestione_luci_scena_crepuscolare_sync") }}

            {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Sera") %}
              {{ states("input_select.gestione_luci_scena_serale_sync") }}

            {% elif is_state("sensor.gestione_luci_fascia_oraria_sync", "Notte") %}
              {{ states("input_select.gestione_luci_scena_notturna_sync") }}

            {% else %}
              {{ states("input_select.gestione_luci_scena_diurna_sync") }}
            {% endif %}
      - service: script.gestione_luci_sync_lampadario_soggiorno_transazione_lunga
      - service: script.gestione_luci_sync_lampada_soggiorno_transazione_lunga
      - service: script.gestione_luci_sync_led_cucina_transazione_lunga
      - service: script.gestione_luci_sync_luce_cucina_transazione_lunga
      - service: script.gestione_luci_sync_bagno_transazione_lunga
      - service: script.gestione_luci_sync_abat_jour_transazione_lunga
      - service: script.gestione_luci_ingresso_transazione_lunga
      - service: script.gestione_luci_corridoio_transazione_lunga
      - service: script.gestione_luci_studio_transazione_lunga
      - service: script.gestione_luci_cameretta_transazione_lunga

  - alias: "gestione_luci_sync_transazione_corta"
    id: 01FGA8G1K5T62HYW8DVND37RT3
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: light.soggiorno_luce_piccola
        to: "on"
      - platform: state
        entity_id: light.soggiorno_luce_grande
        to: "on"
      - platform: state
        entity_id: light.hue_led_cucina
        to: "on"
      - platform: state
        entity_id: light.luce_cucina
        to: "on"
      - platform: state
        entity_id: light.luce_abat_jour
        to: "on"
      - platform: state
        entity_id: light.luce_bagno
        to: "on"
      - platform: state
        entity_id: light.luce_ingresso
        to: "on"
      - platform: state
        entity_id: light.luce_corridoio
        to: "on"
      - platform: state
        entity_id: light.luce_studio
        to: "on"
      - platform: state
        entity_id: light.luce_cameretta
        to: "on"
      - platform: state
        entity_id: light.luce_lampada_soggiorno
        to: "on"
      - platform: state
        entity_id: light.luce_camera_da_letto
        to: "on"
    action:
      - service: >
          {% if trigger.entity_id == 'light.soggiorno_luce_piccola' %} script.gestione_luci_sync_lampadario_soggiorno
          {% elif trigger.entity_id == 'light.soggiorno_luce_grande' %} script.gestione_luci_sync_lampadario_soggiorno
          {% elif trigger.entity_id == 'light.hue_led_cucina' %} script.gestione_luci_sync_led_cucina
          {% elif trigger.entity_id == 'light.luce_cucina' %} script.gestione_luci_sync_luce_cucina
          {% elif trigger.entity_id == 'light.luce_abat_jour' %} script.gestione_luci_sync_abat_jour
          {% elif trigger.entity_id == 'light.luce_bagno' %} script.gestione_luci_sync_bagno
          {% elif trigger.entity_id == 'light.luce_ingresso' %} script.gestione_luci_ingresso
          {% elif trigger.entity_id == 'light.luce_corridoio' %} script.gestione_luci_corridoio
          {% elif trigger.entity_id == 'light.luce_studio' %} script.gestione_luci_studio
          {% elif trigger.entity_id == 'light.luce_cameretta' %} script.gestione_luci_cameretta
          {% elif trigger.entity_id == 'light.luce_camera_da_letto' %} script.gestione_luci_camera_da_letto
          {% elif trigger.entity_id == 'light.luce_lampada_soggiorno' %} script.gestione_luci_sync_lampada_soggiorno
          {% endif %}

  - alias: "gestione_luci_set_auto_max"
    id: dbc604ba69cbda91e7a9856fb7fe7cbf
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: light.soggiorno_luce_piccola
        to: "off"
      - platform: state
        entity_id: light.soggiorno_luce_grande
        to: "off"
      - platform: state
        entity_id: light.hue_led_cucina
        to: "off"
      - platform: state
        entity_id: light.luce_cucina
        to: "off"
      - platform: state
        entity_id: light.luce_abat_jour
        to: "off"
      - platform: state
        entity_id: light.luce_bagno
        to: "off"
      - platform: state
        entity_id: light.luce_ingresso
        to: "off"
      - platform: state
        entity_id: light.luce_corridoio
        to: "off"
      - platform: state
        entity_id: light.luce_studio
        to: "off"
      - platform: state
        entity_id: light.luce_cameretta
        to: "off"
      - platform: state
        entity_id: light.luce_lampada_soggiorno
        to: "off"
      - platform: state
        entity_id: light.luce_camera_da_letto
        to: "off"
    action:
      - service: timer.start
        data:
          entity_id: >
            {% if trigger.entity_id == 'light.soggiorno_luce_piccola' %} timer.gesione_luci_timer_max_lampadario_soggiorno
            {% elif trigger.entity_id == 'light.soggiorno_luce_grande' %} timer.gesione_luci_timer_max_lampadario_soggiorno
            {% elif trigger.entity_id == 'light.hue_led_cucina' %} timer.gesione_luci_timer_max_led_cucina
            {% elif trigger.entity_id == 'light.luce_cucina' %} timer.gesione_luci_timer_max_luce_cucina
            {% elif trigger.entity_id == 'light.luce_abat_jour' %} timer.gesione_luci_timer_max_luce_abat_jour
            {% elif trigger.entity_id == 'light.luce_bagno' %} timer.gesione_luci_timer_max_luce_bagno
            {% elif trigger.entity_id == 'light.luce_ingresso' %} timer.gesione_luci_timer_max_luce_ingresso
            {% elif trigger.entity_id == 'light.luce_corridoio' %} timer.gesione_luci_timer_max_luce_corridoio
            {% elif trigger.entity_id == 'light.luce_studio' %} timer.gesione_luci_timer_max_luce_studio
            {% elif trigger.entity_id == 'light.luce_cameretta' %} timer.gesione_luci_timer_max_luce_cameretta
            {% elif trigger.entity_id == 'light.luce_lampada_soggiorno' %} timer.gesione_luci_timer_max_luce_lampada_soggiorno
            {% endif %}

  - alias: "gestione_luci_sync_transazione_corta_mod_ospite"
    id: 6661f1e126b9cf7525ae33cefc47ab33
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: input_boolean.modo_ospite
    action:
      service: script.turn_on
      data:
        entity_id:
          - script.gestione_luci_sync_lampadario_soggiorno
          - script.gestione_luci_sync_led_cucina
          - script.gestione_luci_sync_luce_cucina
          - script.gestione_luci_sync_abat_jour
          - script.gestione_luci_sync_bagno
          - script.gestione_luci_ingresso
          - script.gestione_luci_corridoio
          - script.gestione_luci_studio
          - script.gestione_luci_cameretta
          - script.gestione_luci_sync_lampada_soggiorno

  - alias: "gestione_luci_sync_int_aree"
    id: db932b4bdb31f0ce75b5496adabeb19f
    mode: parallel
    max_exceeded: silent
    trigger:
      - platform: template
        value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_soggiorno', '0') }}"
      - platform: template
        value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_cucina', '0') }}"
      - platform: template
        value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_ingresso', '0') }}"
      - platform: template
        value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_corridoio', '0') }}"
      - platform: template
        value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_bagno', '0') }}"
      - platform: template
        value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_studio', '0') }}"
      - platform: template
        value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_cameretta', '0') }}"
      - platform: template
        value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_camera_da_letto', '0') }}"
    action:
      - choose:
          - conditions: # soggiorno
              - condition: template
                value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_soggiorno', '0') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id:
                  - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
                  - input_boolean.gestione_luci_lampada_soggiorno_int_sync
                  - input_boolean.gestione_luci_abat_jour_int_sync
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_sync_percentuale_soggiorno
      - choose:
          - conditions: # cucina
              - condition: template
                value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_cucina', '0') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id:
                  - input_boolean.gestione_luci_cucina_int_sync
                  - input_boolean.gestione_luci_led_cucina_int_sync
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_sync_percentuale_cucina
      - choose:
          - conditions: # ingresso
              - condition: template
                value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_ingresso', '0') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id:
                  - input_boolean.gestione_luci_ingresso_int_sync
      - choose:
          - conditions: # corridoio
              - condition: template
                value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_corridoio', '0') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id:
                  - input_boolean.gestione_luci_corridoio_int_sync
      - choose:
          - conditions: # bagno
              - condition: template
                value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_bagno', '0') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id:
                  - input_boolean.gestione_luci_bagno_int_sync
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_sync_percentuale_bagno
      - choose:
          - conditions: # studio
              - condition: template
                value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_studio', '0') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id:
                  - input_boolean.gestione_luci_studio_int_sync
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_sync_percentuale_studio
      - choose:
          - conditions: # cameretta
              - condition: template
                value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_cameretta', '0') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id:
                  - input_boolean.gestione_luci_cameretta_int_sync
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_sync_percentuale_cameretta
      - choose:
          - conditions: # camera da letto
              - condition: template
                value_template: "{{ is_state('sensor.gestione_luci_conteggio_luci_camera_da_letto', '0') }}"
            sequence:
              - service: input_boolean.turn_on
                entity_id:
                  - input_boolean.gestione_luci_camera_da_letto_int_sync
              - service: input_boolean.turn_off
                entity_id: input_boolean.gestione_luci_sync_percentuale_camera_da_letto

  # {% set trigger_name = trigger.to_state.entity_id %}
  # 🚨 Triggered by {{ trigger_name.replace('_','\_') }} {{ trigger.to_state.name }} too high for {{ trigger.entity_id }} !

  # - service: notify.francesco
  #   data_template:
  #     title: 'Avviso'
  #     message: "Demo triggered by: {{state_attr(trigger.entity_id, 'friendly_name')}}, {{ trigger.entity_id }}"

  - alias: "gestione_luci_reset sync"
    id: 793d8c553d316b6d854449c9f4caf01c
    initial_state: true
    trigger:
      platform: time
      at: "03:00:00"
    action:
      - service: input_boolean.turn_on
        entity_id:
          - input_boolean.gestione_luci_lampadario_soggiorno_int_sync
          - input_boolean.gestione_luci_lampada_soggiorno_int_sync
          - input_boolean.gestione_luci_cucina_int_sync
          - input_boolean.gestione_luci_led_cucina_int_sync
          - input_boolean.gestione_luci_bagno_int_sync
          - input_boolean.gestione_luci_abat_jour_int_sync
          - input_boolean.gestione_luci_ingresso_int_sync
          - input_boolean.gestione_luci_corridoio_int_sync
          - input_boolean.gestione_luci_studio_int_sync
          - input_boolean.gestione_luci_cameretta_int_sync
          - input_boolean.gestione_luci_camera_da_letto_int_sync
      - service: input_boolean.turn_off
        entity_id:
          - input_boolean.gestione_luci_sync_percentuale_bagno
          - input_boolean.gestione_luci_sync_percentuale_camera_da_letto
          - input_boolean.gestione_luci_sync_percentuale_cameretta
          - input_boolean.gestione_luci_sync_percentuale_cucina
          - input_boolean.gestione_luci_sync_percentuale_soggiorno
          - input_boolean.gestione_luci_sync_percentuale_studio

  ########################################
  - alias: "Lampada go scena notte"
    id: 4e7aa161f5bbe043f31cf88262330090
    initial_state: true
    trigger:
      - platform: time
        at: input_datetime.lampada_go_attivazione_scena_notte
    condition:
      - condition: state
        entity_id: input_boolean.lampada_go_scena_automatica_notte
        state: "on"
    action:
      - service: hue.activate_scene
        target:
          entity_id: scene.lampada_go_notte
        data:
          transition: 80

  - alias: "Lampada go spegnimento automatico"
    id: 4a84e7c4c1f750bad3dd6923cdaf6009
    initial_state: true
    trigger:
      - platform: time
        at: input_datetime.lampada_go_spegnimento_automatico_notte
    condition:
      - condition: state
        entity_id: input_boolean.lampada_go_spegnimento_automatico_notte
        state: "on"
    action:
      - service: light.turn_off
        target:
          entity_id: light.hue_go

  - alias: "Spegnimento automatico tutte le luci notte"
    id: 1e4e866fd7a343b62cd0444d9f4ed46a
    initial_state: true
    trigger:
      - platform: time
        at: input_datetime.gestione_luci_spegnimento_automatico_notte
    condition:
      - condition: state
        entity_id: input_boolean.gestione_luci_spegnimento_automatico_notte
        state: "on"
    action:
      - service: light.turn_off
        target:
          entity_id: light.tutte_le_luci

  #################################### ACCENDI LUCE RIENTRO SERALE E' NEL PACKAGES PORTA INGRESSO

  # Telecomando on/off e dimming
  - alias: 6 tasti luci con dimmer
    id: eb0225d0b3311517601117d5bf78217d
    mode: restart
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret 6_tasti
    action:
      - variables:
          command: "{{ trigger.event.data.command }}"
          args: "{{ trigger.event.data.args }}"
          light_1: light.luce_corridoio
          light_2: light.soggiorno_luce_piccola
          light_3: light.soggiorno_luce_grande
          light_4: light.luce_abat_jour
          light_5: light.lampadario_soggiorno
          light_6: light.hue_abat_jour
          light_7: light.luce_ingresso
          light_8: light.luce_lampada_soggiorno

      - alias: "Selezione tipo di evento"
        choose:
          - conditions: "{{ command == '1_single' }}"
            sequence:
              - alias: "On/Off luce ingresso"
                service: light.toggle
                target:
                  entity_id: "{{ light_1 }}"

          - conditions: "{{ command == '5_single' }}"
            sequence:
              - alias: "On/Off Luce Piccola"
                service: light.toggle
                target:
                  entity_id: "{{ light_2 }}"

          - conditions: "{{ command == '5_double' }}"
            sequence:
              - alias: "On/Off Luce Grande"
                service: light.toggle
                target:
                  entity_id: "{{ light_3 }}"

          - conditions: "{{ command == '3_single' }}"
            sequence:
              - alias: "On/Off Abat Jour"
                service: light.toggle
                target:
                  entity_id: "{{ light_4 }}"

          - conditions: "{{ command == '6_single' }}"
            sequence:
              - alias: "On/Off luce luce_corridoio"
                service: light.toggle
                target:
                  entity_id: "{{ light_7 }}"

          - conditions: "{{ command == '4_single' }}"
            sequence:
              - alias: "On/Off Lampada soggiorno"
                service: light.toggle
                target:
                  entity_id: "{{ light_8 }}"

          # Dimmer + Lampadario
          - conditions: "{{ command == '5_hold' }}"
            sequence:
              repeat:
                while: "{{ repeat.index <= 10 }}"
                sequence:
                  - service: light.turn_on
                    data:
                      entity_id: "{{ light_5 }}"
                      brightness_step_pct: 10
                  - delay:
                      milliseconds: 500

          # Dimmer - Lampadario
          - conditions: "{{ command == '6_hold' }}"
            sequence:
              repeat:
                while: "{{ repeat.index <= 10 }}"
                sequence:
                  - service: light.turn_on
                    data:
                      entity_id: "{{ light_5 }}"
                      brightness_step_pct: -10
                  - delay:
                      milliseconds: 500

          # Dimmer + abat_jour
          - conditions: "{{ command == '3_hold' }}"
            sequence:
              repeat:
                while: "{{ repeat.index <= 10 }}"
                sequence:
                  - service: light.turn_on
                    data:
                      entity_id: "{{ light_6 }}"
                      brightness_step_pct: 10
                  - delay:
                      milliseconds: 500
          # Dimmer - abat_jour
          - conditions: "{{ command == '4_hold' }}"
            sequence:
              repeat:
                while: "{{ repeat.index <= 10 }}"
                sequence:
                  - service: light.turn_on
                    data:
                      entity_id: "{{ light_6 }}"
                      brightness_step_pct: -10
                  - delay:
                      milliseconds: 500

          # Dimmer + ingresso
          - conditions: "{{ command == '1_hold' }}"
            sequence:
              repeat:
                while: "{{ repeat.index <= 10 }}"
                sequence:
                  - service: light.turn_on
                    data:
                      entity_id: "{{ light_7 }}"
                      brightness_step_pct: 10
                  - delay:
                      milliseconds: 500
          # Dimmer - ingresso
          - conditions: "{{ command == '2_hold' }}"
            sequence:
              repeat:
                while: "{{ repeat.index <= 10 }}"
                sequence:
                  - service: light.turn_on
                    data:
                      entity_id: "{{ light_7 }}"
                      brightness_step_pct: -10
                  - delay:
                      milliseconds: 500

  # Led 1
  - alias: Led 2 cucina toggle con tasto ikea
    id: eb2ef1e793ba96b8808a4d5473593f1c
    mode: single
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_1
          command: "on"
    action:
      - entity_id: light.hue_led_cucina
        service: light.toggle
      - service: script.gestione_luci_sync_led_cucina
      - delay: "00:00:01"

  - alias: Led 2 cucina toggle con tasto aqara
    id: 889ad7c683c10c6d0d4e6c6e019efb13
    mode: single
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_2
          command: "click"
          args:
            click_type: single
    action:
      - entity_id: light.hue_led_cucina
        service: light.toggle
      - service: script.gestione_luci_sync_led_cucina

  - alias: Led UP cucina toggle con tasto aqara
    id: 2d14dab30404398349852380f90bf615
    mode: single
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_2
          command: "click"
          args:
            click_type: double
    action:
      - entity_id: light.led_1_cucina
        service: light.toggle
      - delay: "00:00:01"

  - alias: Led UP cucina toggle con tasto ikea
    id: 7a1601192bb9a8c77aab4bdc8b61e8b7
    mode: single
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_1
          command: "off"
    action:
      - entity_id: light.led_1_cucina
        service: light.toggle
      - delay: "00:00:01"

  - alias: Led cucina all off
    id: c94c142529dc74837a23cfeecdf4aadb
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_1
          command: "move_with_on_off"
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: !secret tasto_led_2
          command: "hold"
    action:
      - entity_id: light.hue_led_cucina
        service: light.turn_off
      - entity_id: light.led_1_cucina
        service: light.turn_off

  ########################################

  # Telecomando on/off e dimming
  - alias: "Dimmer Luce bagno"
    id: fde473c4775cdbd2204fa20169eee356
    mode: restart
    trigger:
      - platform: event
        event_type: zha_event
        event_data:
          device_ieee: "00:15:8d:00:02:3d:37:94"
    action:
      - variables:
          command: "{{ trigger.event.data.command }}"
          args: "{{ trigger.event.data.args }}"
          light_dest: light.hue_bagno
      - alias: "Selezione tipo di evento"
        choose:
          # Holt tasto ON (aumenta luminosità)
          - conditions: "{{ command == 'hold' }}"
            sequence:
              repeat:
                while: "{{ repeat.index <= 10 }}"
                sequence:
                  - service: light.turn_on
                    data:
                      entity_id: "{{ light_dest }}"
                      brightness_step_pct: 10
                  - delay: 1

  ########################################

  # Luce Corridoio
  - alias: "gestione_luci_luce_nottura on"
    id: 7dc12352ee0c2c4a800d7c8a0c8a1788
    mode: restart
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: binary_sensor.pir_corridoio
        to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.gestione_luci_luce_nottura
        state: "on"
      - condition: state
        entity_id:
          - light.luce_abat_jour
          - light.luce_corridoio
          - light.luce_ingresso
          - light.luce_cucina
          - light.led_1_cucina
          - light.hue_led_cucina
          - light.soggiorno_luce_piccola
          - light.soggiorno_luce_grande
        state: "off"
      - condition: time
        after: "23:30:00"
        before: "06:30:00"
    action:
      - service: light.turn_on
        target:
          entity_id: light.luce_corridoio
      - service: input_boolean.turn_on
        target:
          entity_id: input_boolean.gestione_luci_luce_nottura_off

  - alias: "gestione_luci_luce_nottura off"
    id: 5eeb8c1e99f9a98fee861bed088516fa
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: light.luce_corridoio
        to: "on"
        for:
          minutes: 5
    condition:
      - condition: state
        entity_id: input_boolean.gestione_luci_luce_nottura_off
        state: "on"
    action:
      - service: light.turn_off
        target:
          entity_id: light.luce_corridoio
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.gestione_luci_luce_nottura_off

  - alias: "gestione_luci_luce_nottura_reset_boolean"
    id: c4a123603b76543bf31890a65319ade7
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: light.luce_corridoio
        to: "off"
    action:
      - service: input_boolean.turn_off
        target:
          entity_id: input_boolean.gestione_luci_luce_nottura_off

  - alias: "gestione_luci_luce_corridoio_auto_off"
    id: 5b8e2161d474f084b8b183a9cf15fe1b
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: light.luce_corridoio
        to: "on"
        for:
          minutes: 10
    condition:
      - condition: state
        entity_id: input_boolean.gestione_luci_luce_corridoio_auto_off
        state: "on"
    action:
      - service: light.turn_off
        target:
          entity_id: light.luce_corridoio
